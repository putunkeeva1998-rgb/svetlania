<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>SVETLANIA</title>
    <script src="https://unpkg.com/vue@3/dist/vue.global.prod.js"></script>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://maps.api.2gis.ru/2.0/loader.js?pkg=full"></script>
    
    <link href="https://fonts.googleapis.com/css2?family=Ruslan+Display&display=swap" rel="stylesheet">
    
    <style>
        :root { --gold: #D4AF37; --bg: #fffaf0; --dark: #1a1a1a; }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; outline: none; }
        body { margin: 0; background: var(--bg); font-family: -apple-system, sans-serif; color: var(--dark); overflow-x: hidden; }
        
        .header { background: #fff; padding: 15px; text-align: center; border-bottom: 2px solid var(--gold); position: sticky; top: 0; z-index: 100; }
        .old-russian { font-family: 'Ruslan Display', cursive; color: var(--gold); font-size: 28px; margin: 0; text-transform: uppercase; letter-spacing: 2px; }
        
        .container { padding: 15px; padding-bottom: 120px; }
        
        .products-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
        .card { background: #fff; border-radius: 20px; overflow: hidden; box-shadow: 0 4px 15px rgba(0,0,0,0.05); position: relative; border: 1px solid rgba(212, 175, 55, 0.1); }
        .card img { width: 100%; aspect-ratio: 3/4; object-fit: cover; display: block; }
        .card-info { padding: 12px; text-align: center; }
        .card-price { color: var(--gold); font-weight: 800; }

        .fav-btn { position: absolute; top: 10px; right: 10px; background: rgba(255,255,255,0.9); border: none; border-radius: 50%; width: 32px; height: 32px; display: flex; align-items: center; justify-content: center; font-size: 18px; color: #ccc; }
        .fav-btn.active { color: #e74c3c; }

        .input-group { margin-bottom: 15px; }
        .input-group label { display: block; font-size: 12px; color: var(--gold); font-weight: bold; margin-bottom: 5px; }
        .input-field { width: 100%; padding: 12px; border-radius: 12px; border: 1px solid #ddd; font-size: 14px; }

        .bottom-nav { position: fixed; bottom: 0; left: 0; right: 0; background: #fff; display: flex; justify-content: space-around; padding: 12px; border-top: 1px solid #eee; z-index: 1000; }
        .nav-item { border: none; background: none; color: #bbb; display: flex; flex-direction: column; align-items: center; font-size: 9px; font-weight: bold; }
        .nav-item.active { color: var(--gold); }

        .cat-btn { padding: 10px 15px; border-radius: 20px; border: 1px solid var(--gold); background: #fff; color: var(--gold); margin-right: 5px; font-size: 12px; }
        .cat-btn.active { background: var(--gold); color: #fff; }

        /* –í–∞–∂–Ω–æ: –∑–∞–¥–∞–µ–º —á–µ—Ç–∫–∏–µ —Ä–∞–∑–º–µ—Ä—ã –¥–ª—è –∫–∞—Ä—Ç—ã */
        #map { width: 100%; height: 250px; border-radius: 15px; margin-top: 10px; border: 1px solid var(--gold); background-color: #f0f0f0; position: relative; }

        .modal { position: fixed; inset: 0; background: #fff; z-index: 2000; overflow-y: auto; padding-bottom: 50px; }
        .close-btn { position: fixed; top: 20px; left: 20px; background: #fff; border-radius: 50%; width: 40px; height: 40px; border: 1px solid #eee; z-index: 2100; font-size: 20px; color: var(--gold); }
        .btn-main { width: 100%; padding: 16px; background: var(--gold); color: #fff; border: none; border-radius: 15px; font-weight: bold; margin-top: 15px; }
        .btn-main:disabled { background: #ccc; }
    </style>
</head>
<body>

<div id="app">
    <div class="header"><h1 class="old-russian">SVETLANIA</h1></div>

    <div class="container">
        <div v-if="activeTab === 'catalog'">
            <div style="display: flex; overflow-x: auto; padding-bottom: 15px;">
                <button v-for="cat in categories" @click="currentCategory = cat" :class="['cat-btn', currentCategory === cat ? 'active' : '']">{{cat}}</button>
            </div>
            <div class="products-grid">
                <div v-for="p in filteredProducts" :key="p.id" class="card" @click="openProduct(p)">
                    <button class="fav-btn" @click.stop="toggleFav(p)" :class="{active: isFav(p)}">‚ù§</button>
                    <img :src="p.image">
                    <div class="card-info">
                        <div style="font-size: 11px;">{{p.name}}</div>
                        <div class="card-price">{{p.price}} ‚ÇΩ</div>
                    </div>
                </div>
            </div>
        </div>

        <div v-if="activeTab === 'favs'">
            <h2 class="old-russian" style="font-size: 20px;">–ò–∑–±—Ä–∞–Ω–Ω–æ–µ</h2>
            <div v-if="favItems.length === 0" style="text-align: center; margin-top: 50px; color: #999;">–¢—É—Ç –ø–æ–∫–∞ –ø—É—Å—Ç–æ</div>
            <div v-else class="products-grid">
                <div v-for="p in favItems" :key="p.id" class="card" @click="openProduct(p)">
                    <button class="fav-btn active" @click.stop="toggleFav(p)">‚ù§</button>
                    <img :src="p.image">
                    <div class="card-info"><div>{{p.name}}</div><div class="card-price">{{p.price}} ‚ÇΩ</div></div>
                </div>
            </div>
        </div>

        <div v-if="activeTab === 'cart'">
            <h2 class="old-russian" style="font-size: 20px;">–û—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ</h2>
            <div v-if="cart.length === 0" style="text-align: center; margin-top: 50px; color: #999;">–ü—É—Å—Ç–æ</div>
            <div v-else>
                <div v-for="item in cart" :key="item.cartId" style="display: flex; gap: 10px; padding: 10px; border-bottom: 1px solid #eee;">
                    <img :src="item.image" style="width: 40px; height: 50px; object-fit: cover;">
                    <div style="flex: 1; font-size: 12px;"><b>{{item.name}}</b> ({{item.size}})<br>{{item.price}} ‚ÇΩ</div>
                    <button @click="removeFromCart(item.cartId)">‚úï</button>
                </div>

                <div style="background: #fff; padding: 15px; border-radius: 15px; margin-top: 15px;">
                    <div class="input-group"><label>–ò–ú–Ø</label><input class="input-field" v-model="form.firstName"></div>
                    <div class="input-group"><label>–¢–ï–õ–ï–§–û–ù</label><input class="input-field" v-model="form.phone" type="tel"></div>
                    
                    <label style="font-size: 12px; font-weight: bold;">–î–û–°–¢–ê–í–ö–ê</label>
                    <div style="display: flex; gap: 5px; margin: 10px 0;">
                        <button v-for="m in ['–°–î–≠–ö', '–ü–æ—á—Ç–∞']" @click="setDelivery(m)" :class="['cat-btn', deliveryMode === m ? 'active' : '']" style="flex: 1;">{{m}}</button>
                    </div>

                    <div v-show="deliveryMode">
                        <p style="font-size: 11px;">üìç <b>–ê–¥—Ä–µ—Å:</b> {{address || '–ö–ª–∏–∫–Ω–∏—Ç–µ –Ω–∞ –∫–∞—Ä—Ç—É'}}</p>
                        <div id="map"></div>
                    </div>
                </div>
                <button class="btn-main" @click="sendOrder" :disabled="!isFormValid">–ó–ê–ö–ê–ó–ê–¢–¨: {{totalSum}} ‚ÇΩ</button>
            </div>
        </div>
    </div>

    <div v-if="selectedProduct" class="modal">
        <button class="close-btn" @click="selectedProduct = null">‚úï</button>
        <img :src="selectedProduct.image" style="width: 100%">
        <div style="padding: 20px;">
            <h2 class="old-russian">{{selectedProduct.name}}</h2>
            <div class="card-price">{{selectedProduct.price}} ‚ÇΩ</div>
            <div style="display: flex; margin-top: 15px;">
                <button v-for="s in selectedProduct.sizes" @click="tempSize = s" :class="['cat-btn', tempSize === s ? 'active' : '']" style="flex: 1;">{{s}}</button>
            </div>
            <button class="btn-main" @click="addToCart">–í –ö–û–†–ó–ò–ù–£</button>
        </div>
    </div>

    <nav class="bottom-nav">
        <button @click="activeTab = 'catalog'" :class="['nav-item', activeTab === 'catalog' ? 'active' : '']">üè∞ –ö–ê–¢–ê–õ–û–ì</button>
        <button @click="activeTab = '
