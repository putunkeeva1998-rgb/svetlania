<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>SVETLANIA</title>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://maps.api.2gis.ru/2.0/loader.js?pkg=full"></script>
    <link href="https://fonts.googleapis.com/css2?family=Ruslan+Display&display=swap" rel="stylesheet">
    <style>
        :root { --gold: #D4AF37; --dark-gold: #996515; }
        body { background-color: #fffaf0; font-family: 'Segoe UI', sans-serif; -webkit-tap-highlight-color: transparent; }
        .old-russian { font-family: 'Ruslan Display', cursive; color: var(--gold); }
        .gold-border { border: 1px solid var(--gold); }
        .gold-bg { background-color: var(--gold); }
        .active-tab { color: var(--gold); border-top: 2px solid var(--gold); }
        .size-btn.active { background-color: var(--gold); color: white; border-color: var(--gold); }
        #map { width: 100%; height: 250px; border-radius: 12px; margin-top: 10px; display: none; }
    </style>
</head>
<body>
<div id="app" class="pb-24">
    <header class="text-center py-4 bg-white shadow-sm sticky top-0 z-50">
        <h1 class="old-russian text-3xl">SVETLANIA</h1>
    </header>

    <div v-if="activeTab === 'catalog'" class="p-4">
        <div class="flex gap-2 mb-6 overflow-x-auto pb-2">
            <button @click="vibrate(); currentCategory = '—Ö–∞–ª–∞—Ç—ã'" 
                    :class="['px-6 py-2 rounded-full border gold-border transition', currentCategory === '—Ö–∞–ª–∞—Ç—ã' ? 'gold-bg text-white' : 'text-gold']">
                –•–∞–ª–∞—Ç—ã
            </button>
            <button @click="vibrate(); currentCategory = '—Å–æ—Ä–æ—á–∫–∏'" 
                    :class="['px-6 py-2 rounded-full border gold-border transition', currentCategory === '—Å–æ—Ä–æ—á–∫–∏' ? 'gold-bg text-white' : 'text-gold']">
                –°–æ—Ä–æ—á–∫–∏
            </button>
        </div>

        <div class="grid grid-cols-2 gap-4">
            <div v-for="product in filteredProducts" :key="product.id" class="bg-white rounded-xl shadow-sm overflow-hidden relative">
                <button @click="vibrate(); toggleFavorite(product)" class="absolute top-2 right-2 z-10 p-2 bg-white/80 rounded-full">
                    <span :class="isFavorite(product) ? 'text-red-500' : 'text-gray-400'">‚ù§</span>
                </button>
                <div @click="openProduct(product)" class="aspect-[3/4] bg-gray-200 flex items-center justify-center text-gray-400">
                    –§–æ—Ç–æ —Ç–æ–≤–∞—Ä–∞
                </div>
                <div class="p-2" @click="openProduct(product)">
                    <h3 class="text-sm font-medium truncate">{{ product.name }}</h3>
                    <p class="text-gold font-bold">{{ product.price }} ‚ÇΩ</p>
                </div>
            </div>
        </div>
    </div>

    <div v-if="activeTab === 'favorites'" class="p-4">
        <h2 class="text-xl font-bold mb-4">–ò–∑–±—Ä–∞–Ω–Ω–æ–µ</h2>
        <div v-if="favorites.length === 0" class="text-center text-gray-500 mt-20">–ó–¥–µ—Å—å –ø–æ–∫–∞ –ø—É—Å—Ç–æ</div>
        <div v-for="item in favorites" class="flex gap-4 bg-white p-3 rounded-xl mb-3 shadow-sm">
            <div class="w-20 h-24 bg-gray-200 rounded"></div>
            <div>
                <h3 class="font-medium">{{ item.name }}</h3>
                <p class="text-gold">{{ item.price }} ‚ÇΩ</p>
                <button @click="vibrate(); removeFromFavorites(item.id)" class="text-red-400 text-sm mt-2">–£–¥–∞–ª–∏—Ç—å</button>
            </div>
        </div>
    </div>

    <div v-if="activeTab === 'cart'" class="p-4">
        <h2 class="text-xl font-bold mb-4">–ö–æ—Ä–∑–∏–Ω–∞</h2>
        <div v-for="item in cart" class="flex gap-4 bg-white p-3 rounded-xl mb-3 shadow-sm">
            <div class="w-20 h-24 bg-gray-200 rounded"></div>
            <div class="flex-1">
                <div class="flex justify-between">
                    <h3 class="font-medium">{{ item.name }}</h3>
                    <button @click="vibrate(); removeFromCart(item.id)">‚úï</button>
                </div>
                <p class="text-gray-500 text-sm">–†–∞–∑–º–µ—Ä: {{ item.selectedSize }}</p>
                <p class="text-gold font-bold">{{ item.price }} ‚ÇΩ</p>
            </div>
        </div>

        <div v-if="cart.length > 0" class="mt-6">
            <h3 class="font-bold mb-2">–°–ø–æ—Å–æ–± –¥–æ—Å—Ç–∞–≤–∫–∏</h3>
            <div class="grid grid-cols-3 gap-2 mb-4">
                <button v-for="m in ['5post', '–°–î–≠–ö', '–ü–æ—á—Ç–∞']" @click="selectDelivery(m)" 
                        :class="['py-2 text-xs rounded border gold-border', deliveryMode === m ? 'gold-bg text-white' : '']">
                    {{m}}
                </button>
            </div>
            
            <div v-if="deliveryMode" class="bg-white p-4 rounded-xl border gold-border">
                <p class="text-sm font-bold mb-2">–ê–¥—Ä–µ—Å –ø–æ–ª—É—á–µ–Ω–∏—è:</p>
                <p class="text-sm text-gray-600 mb-2">{{ address || '–ù–∞–∂–º–∏—Ç–µ –Ω–∞ –∫–∞—Ä—Ç—É –¥–ª—è –≤—ã–±–æ—Ä–∞' }}</p>
                <div id="map"></div>
            </div>

            <button @click="sendOrder" class="w-full gold-bg text-white py-4 rounded-xl mt-6 font-bold shadow-lg">
                –û–§–û–†–ú–ò–¢–¨ –†–ê–°–ß–ï–¢: {{ totalCart }} ‚ÇΩ
            </button>
        </div>
    </div>

    <div v-if="activeTab === 'profile'" class="p-4 text-center">
        <img :src="user.photo" class="w-24 h-24 rounded-full mx-auto border-4 border-gold shadow-md">
        <h2 class="text-xl font-bold mt-4">{{ user.name }}</h2>
        
        <div class="mt-8 text-left">
            <h3 class="font-bold mb-2">–ò—Å—Ç–æ—Ä–∏—è –∑–∞–∫–∞–∑–æ–≤</h3>
            <div class="bg-white p-4 rounded-xl shadow-sm text-sm text-gray-500">
                –ó–∞–∫–∞–∑–æ–≤ –ø–æ–∫–∞ –Ω–µ—Ç
            </div>
        </div>

        <a href="https://t.me/–í–ê–®_–ù–ò–ö" @click="vibrate" class="block w-full mt-10 p-4 border gold-border text-gold rounded-xl font-bold">
            –ù–∞–ø–∏—Å–∞—Ç—å –≤ –ø–æ–¥–¥–µ—Ä–∂–∫—É
        </a>
    </div>

    <div v-if="selectedProduct" class="fixed inset-0 z-[100] bg-white overflow-y-auto p-4">
        <button @click="selectedProduct = null" class="absolute top-4 left-4 text-2xl">‚úï</button>
        <div class="w-full h-80 bg-gray-200 rounded-3xl mt-10 flex items-center justify-center text-gray-400">–§–æ—Ç–æ</div>
        <h2 class="text-2xl font-bold mt-6">{{ selectedProduct.name }}</h2>
        <p class="text-gold text-xl font-bold">{{ selectedProduct.price }} ‚ÇΩ</p>
        
        <div class="mt-6">
            <p class="font-bold mb-2">–í—ã–±–µ—Ä–∏—Ç–µ —Ä–∞–∑–º–µ—Ä:</p>
            <div class="flex gap-2">
                <button v-for="s in selectedProduct.sizes" @click="tempSize = s"
                        :class="['size-btn w-12 h-12 rounded-xl border gold-border', tempSize === s ? 'active' : '']">
                    {{ s }}
                </button>
            </div>
        </div>

        <p class="mt-6 text-gray-600 leading-relaxed">{{ selectedProduct.desc }}</p>

        <button @click="addToCart" class="w-full gold-bg text-white py-4 rounded-xl mt-10 font-bold mb-10">
            –î–û–ë–ê–í–ò–¢–¨ –í –ö–û–†–ó–ò–ù–£
        </button>
    </div>

    <nav class="fixed bottom-0 left-0 right-0 bg-white border-t flex justify-around py-3 z-50 shadow-[0_-2px_10px_rgba(0,0,0,0.05)]">
        <button v-for="(btn, key) in navButtons" @click="setTab(key)" :class="['flex flex-col items-center gap-1', activeTab === key ? 'text-gold' : 'text-gray-400']">
            <span class="text-xl">{{ btn.icon }}</span>
            <span class="text-[10px] uppercase font-bold">{{ btn.label }}</span>
        </button>
    </nav>
</div>

<script>
    const { createApp } = Vue;
    const tg = window.Telegram.WebApp;

    createApp({
        data() {
            return {
                activeTab: 'catalog',
                currentCategory: '—Ö–∞–ª–∞—Ç—ã',
                selectedProduct: null,
                tempSize: null,
                deliveryMode: null,
                address: '',
                map: null,
                user: { name: '–ì–æ—Å—Ç—å', photo: 'https://via.placeholder.com/150' },
                products: [
                    { id: 1, category: '—Ö–∞–ª–∞—Ç—ã', name: '–ó–æ–ª–æ—Ç–æ–π —à–µ–ª–∫', price: 4500, sizes: ['S', 'M', 'L'], desc: '–î—Ä–µ–≤–Ω–µ—Ä—É—Å—Å–∫–∏–π —É–∑–æ—Ä –Ω–∞ –ø—Ä–µ–º–∏–∞–ª—å–Ω–æ–º —à–µ–ª–∫–µ.' },
                    { id: 2, category: '—Ö–∞–ª–∞—Ç—ã', name: '–ë–µ–ª—ã–π –ª–µ–±–µ–¥—å', price: 5200, sizes: ['M', 'L', 'XL'], desc: '–ú—è–≥–∫–∏–π —Ö–ª–æ–ø–æ–∫ —Å –≤—ã—à–∏–≤–∫–æ–π.' },
                    { id: 3, category: '—Å–æ—Ä–æ—á–∫–∏', name: '–£—Ç—Ä–µ–Ω–Ω—è—è —Ä–æ—Å–∞', price: 2800, sizes: ['XS', 'S', 'M'], desc: '–õ–µ–≥–∫–∞—è —Å–æ—Ä–æ—á–∫–∞ –¥–ª—è –Ω–µ–∂–Ω–æ–≥–æ —Å–Ω–∞.' },
                    { id: 4, category: '—Å–æ—Ä–æ—á–∫–∏', name: '–í–µ—á–µ—Ä–Ω—è—è –∑–∞—Ä—è', price: 3100, sizes: ['S', 'M'], desc: '–≠–ª–µ–≥–∞–Ω—Ç–Ω–æ–µ –∫—Ä—É–∂–µ–≤–æ –∏ –∞—Ç–ª–∞—Å.' }
                ],
                favorites: [],
                cart: [],
                navButtons: {
                    catalog: { label: '–ö–∞—Ç–∞–ª–æ–≥', icon: 'üèõ' },
                    favorites: { label: '–ò–∑–±—Ä–∞–Ω–Ω–æ–µ', icon: '‚ù§' },
                    cart: { label: '–ö–æ—Ä–∑–∏–Ω–∞', icon: 'üõí' },
                    profile: { label: '–ü—Ä–æ—Ñ–∏–ª—å', icon: 'üë§' }
                }
            }
        },
        computed: {
            filteredProducts() { return this.products.filter(p => p.category === this.currentCategory) },
            totalCart() { return this.cart.reduce((sum, item) => sum + item.price, 0) }
        },
        methods: {
            vibrate() { if (tg.HapticFeedback) tg.HapticFeedback.impactOccurred('medium'); },
            setTab(tab) { this.vibrate(); this.activeTab = tab; },
            openProduct(p) { this.vibrate(); this.selectedProduct = p; this.tempSize = p.sizes[0]; },
            isFavorite(p) { return this.favorites.some(f => f.id === p.id) },
            toggleFavorite(p) {
                const idx = this.favorites.findIndex(f => f.id === p.id);
                if (idx > -1) this.favorites.splice(idx, 1);
                else this.favorites.push({...p, size: this.tempSize || p.sizes[0]});
            },
            addToCart() {
                this.vibrate();
                this.cart.push({ ...this.selectedProduct, selectedSize: this.tempSize });
                this.selectedProduct = null;
                tg.MainButton.setText("–ü–ï–†–ï–ô–¢–ò –í –ö–û–†–ó–ò–ù–£").show().onClick(() => this.activeTab = 'cart');
            },
            selectDelivery(mode) {
                this.vibrate();
                this.deliveryMode = mode;
                document.getElementById('map').style.display = 'block';
                this.initMap();
            },
            initMap() {
                if (this.map) return;
                dg.loader.init(() => {
                    this.map = new dg.Map('map', { center: [55.75, 37.61], zoom: 11 });
                    this.map.on('click', (e) => {
                        const { lat, lng } = e.latlng;
                        fetch(`https://catalog.api.2gis.com/3.0/items/geocode?lat=${lat}&lon=${lng}&fields=items.address&key=cab82c94-e619-42eb-9814-3361712feaf0`)
                        .then(r => r.json())
                        .then(data => {
                            const res = data.result.items[0];
                            this.address = res.address_name || res.full_name;
                        });
                    });
                });
            },
            sendOrder() {
                const orderData = {
                    items: this.cart,
                    total: this.totalCart,
                    address: this.address,
                    fio: this.user.name
                };
                tg.sendData(JSON.stringify(orderData));
            }
        },
        mounted() {
            tg.ready();
            tg.expand();
            if (tg.initDataUnsafe?.user) {
                this.user.name = tg.initDataUnsafe.user.first_name;
                this.user.photo = tg.initDataUnsafe.user.photo_url || this.user.photo;
            }
        }
    }).mount('#app');
</script>
</body>
</html>
