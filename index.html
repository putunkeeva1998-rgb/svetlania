<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>SVETLANIA</title>
    <script src="https://unpkg.com/vue@3/dist/vue.global.prod.js"></script>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://maps.api.2gis.ru/2.0/loader.js?pkg=full"></script>
    <link href="https://fonts.googleapis.com/css2?family=Ruslan+Display&display=swap" rel="stylesheet">
    
    <style>
        :root { --gold: #D4AF37; --bg: #fffaf0; --dark: #1a1a1a; }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; outline: none; }
        body { margin: 0; background: var(--bg); font-family: -apple-system, sans-serif; color: var(--dark); overflow-x: hidden; }
        
        .header { background: #fff; padding: 15px; text-align: center; border-bottom: 2px solid var(--gold); position: sticky; top: 0; z-index: 100; }
        .old-russian { font-family: 'Ruslan Display', cursive; color: var(--gold); font-size: 26px; margin: 0; text-transform: uppercase; letter-spacing: 2px; }
        
        .container { padding: 15px; padding-bottom: 120px; }
        .products-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
        
        /* –ö–∞—Ä—Ç–æ—á–∫–∞ —Ç–æ–≤–∞—Ä–∞ */
        .card { background: #fff; border-radius: 20px; overflow: hidden; box-shadow: 0 4px 15px rgba(0,0,0,0.05); position: relative; border: 1px solid rgba(212, 175, 55, 0.1); }
        .card img { width: 100%; aspect-ratio: 3/4; object-fit: cover; display: block; }
        .card-info { padding: 10px; text-align: center; }
        .card-price { color: var(--gold); font-weight: 800; font-size: 14px; }
        .card-sizes { font-size: 10px; color: #888; margin-top: 4px; font-weight: bold; }

        .fav-btn { position: absolute; top: 10px; right: 10px; background: rgba(255,255,255,0.9); border: none; border-radius: 50%; width: 30px; height: 30px; display: flex; align-items: center; justify-content: center; font-size: 16px; color: #ccc; z-index: 5; }
        .fav-btn.active { color: #e74c3c; }

        /* –ù–∞–≤–∏–≥–∞—Ü–∏—è */
        .bottom-nav { position: fixed; bottom: 0; left: 0; right: 0; background: #fff; display: flex; justify-content: space-around; padding: 10px; border-top: 1px solid #eee; z-index: 1000; }
        .nav-item { border: none; background: none; color: #bbb; display: flex; flex-direction: column; align-items: center; font-size: 9px; font-weight: bold; gap: 4px; }
        .nav-item.active { color: var(--gold); }
        .nav-icon { font-size: 20px; }

        /* –ü—Ä–æ—Ñ–∏–ª—å */
        .profile-card { text-align: center; background: #fff; padding: 30px 20px; border-radius: 20px; border: 1px solid var(--gold); margin-top: 20px; }
        .user-photo { width: 100px; height: 100px; border-radius: 50%; border: 3px solid var(--gold); margin-bottom: 15px; object-fit: cover; }

        /* –§–æ—Ä–º—ã */
        .input-group { margin-bottom: 15px; text-align: left; }
        .input-group label { display: block; font-size: 11px; color: var(--gold); font-weight: bold; margin-bottom: 4px; }
        .input-field { width: 100%; padding: 12px; border-radius: 12px; border: 1px solid #ddd; font-size: 14px; }
        .error-text { color: #e74c3c; font-size: 10px; margin-top: 4px; }

        .cat-btn { padding: 8px 15px; border-radius: 20px; border: 1px solid var(--gold); background: #fff; color: var(--gold); margin-right: 5px; font-size: 12px; }
        .cat-btn.active { background: var(--gold); color: #fff; }

        #map { width: 100%; height: 200px; border-radius: 15px; margin-top: 10px; border: 1px solid var(--gold); }
        .btn-main { width: 100%; padding: 16px; background: var(--gold); color: #fff; border: none; border-radius: 15px; font-weight: bold; margin-top: 15px; }
        .btn-main:disabled { background: #ccc; }
        
        .modal { position: fixed; inset: 0; background: #fff; z-index: 2000; overflow-y: auto; padding-bottom: 50px; }
    </style>
</head>
<body>

<div id="app">
    <div class="header"><h1 class="old-russian">SVETLANIA</h1></div>

    <div class="container">
        <div v-if="activeTab === 'catalog'">
            <div style="display: flex; overflow-x: auto; padding-bottom: 15px; scrollbar-width: none;">
                <button v-for="cat in categories" @click="currentCategory = cat" :class="['cat-btn', currentCategory === cat ? 'active' : '']">{{cat}}</button>
            </div>
            <div class="products-grid">
                <div v-for="p in filteredProducts" :key="p.id" class="card" @click="openProduct(p)">
                    <button class="fav-btn" @click.stop="toggleFav(p)" :class="{active: isFav(p)}">‚ù§</button>
                    <img :src="p.image">
                    <div class="card-info">
                        <div style="font-size: 11px; font-weight: 600;">{{p.name}}</div>
                        <div class="card-price">{{p.price}} ‚ÇΩ</div>
                        <div class="card-sizes">–†–∞–∑–º–µ—Ä—ã: {{p.sizes.join(', ')}}</div>
                    </div>
                </div>
            </div>
        </div>

        <div v-if="activeTab === 'favs'">
            <h2 class="old-russian" style="font-size: 20px;">–ò–∑–±—Ä–∞–Ω–Ω–æ–µ</h2>
            <div v-if="favItems.length === 0" style="text-align: center; margin-top: 50px; color: #999;">–ù–∏—á–µ–≥–æ –Ω–µ –≤—ã–±—Ä–∞–Ω–æ</div>
            <div v-else class="products-grid">
                <div v-for="p in favItems" :key="p.id" class="card" @click="openProduct(p)">
                    <button class="fav-btn active" @click.stop="toggleFav(p)">‚ù§</button>
                    <img :src="p.image">
                    <div class="card-info">
                        <div>{{p.name}}</div>
                        <div class="card-price">{{p.price}} ‚ÇΩ</div>
                        <div class="card-sizes">–†–∞–∑–º–µ—Ä—ã: {{p.sizes.join(', ')}}</div>
                    </div>
                </div>
            </div>
        </div>

        <div v-if="activeTab === 'profile'">
            <div class="profile-card">
                <img :src="user.photo || 'https://cdn-icons-png.flaticon.com/512/149/149071.png'" class="user-photo">
                <h3 style="margin: 0; color: var(--gold);">{{user.first_name}} {{user.last_name}}</h3>
                <p style="font-size: 12px; color: #888;">ID: {{user.id}}</p>
                <button class="btn-main" @click="contactSupport">–ù–ê–ü–ò–°–ê–¢–¨ –í –ü–û–î–î–ï–†–ñ–ö–£</button>
            </div>
        </div>

        <div v-if="activeTab === 'cart'">
            <h2 class="old-russian" style="font-size: 20px;">–û—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ</h2>
            <div v-if="cart.length === 0" style="text-align: center; margin-top: 50px; color: #999;">–ö–æ—Ä–∑–∏–Ω–∞ –ø—É—Å—Ç–∞</div>
            <div v-else>
                <div v-for="item in cart" :key="item.cartId" style="display: flex; gap: 10px; padding: 10px; border-bottom: 1px solid #eee; align-items: center;">
                    <img :src="item.image" style="width: 40px; height: 50px; object-fit: cover; border-radius: 5px;">
                    <div style="flex: 1; font-size: 12px;"><b>{{item.name}}</b> ({{item.size}})<br>{{item.price}} ‚ÇΩ</div>
                    <button @click="removeFromCart(item.cartId)" style="border: none; background: none; color: #ccc;">‚úï</button>
                </div>

                <div style="background: #fff; padding: 15px; border-radius: 15px; margin-top: 15px; border: 1px solid #eee;">
                    <div class="input-group">
                        <label>–¢–ï–õ–ï–§–û–ù</label>
                        <input class="input-field" v-model="form.phone" type="tel" placeholder="+7 999 000 00 00">
                        <div v-if="phoneError" class="error-text">–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –Ω–æ–º–µ—Ä</div>
                    </div>
                    <label style="font-size: 12px; font-weight: bold;">–î–û–°–¢–ê–í–ö–ê</label>
                    <div style="display: flex; gap: 5px; margin: 10px 0;">
                        <button v-for="m in ['–°–î–≠–ö', '–ü–æ—á—Ç–∞']" @click="setDelivery(m)" :class="['cat-btn', deliveryMode === m ? 'active' : '']" style="flex: 1;">{{m}}</button>
                    </div>
                    <div v-show="deliveryMode">
                        <p style="font-size: 11px;">üìç <b>–ê–¥—Ä–µ—Å:</b> {{address || '–ö–ª–∏–∫–Ω–∏—Ç–µ –Ω–∞ –∫–∞—Ä—Ç—É'}}</p>
                        <div id="map"></div>
                    </div>
                </div>
                <button class="btn-main" @click="sendOrder" :disabled="!isFormValid">–ó–ê–ö–ê–ó–ê–¢–¨: {{totalSum}} ‚ÇΩ</button>
            </div>
        </div>
    </div>

    <div v-if="selectedProduct" class="modal">
        <button @click="selectedProduct = null" style="position:fixed; top:20px; left:20px; z-index:2100; border:none; background:#fff; border-radius:50%; width:40px; height:40px; box-shadow:0 2px 10px rgba(0,0,0,0.1);">‚úï</button>
        <img :src="selectedProduct.image" style="width: 100%">
        <div style="padding: 20px;">
            <h2 class="old-russian">{{selectedProduct.name}}</h2>
            <div class="card-price" style="font-size: 22px;">{{selectedProduct.price}} ‚ÇΩ</div>
            <p style="font-size: 13px; color: #666;">{{selectedProduct.desc}}</p>
            <div style="display: flex; gap: 5px; margin-top: 15px;">
                <button v-for="s in selectedProduct.sizes" @click="tempSize = s" :class="['cat-btn', tempSize === s ? 'active' : '']" style="flex:1;">{{s}}</button>
            </div>
            <button class="btn-main" @click="addToCart">–í –ö–û–†–ó–ò–ù–£</button>
        </div>
    </div>

    <nav class="bottom-nav">
        <button @click="activeTab = 'catalog'" :class="['nav-item', activeTab === 'catalog' ? 'active' : '']"><span class="nav-icon">üè∞</span>–ö–ê–¢–ê–õ–û–ì</button>
        <button @click="activeTab = 'favs'" :class="['nav-item', activeTab === 'favs' ? 'active' : '']"><span class="nav-icon">‚ù§</span>–ò–ó–ë–†–ê–ù–ù–û–ï</button>
        <button @click="activeTab = 'cart'" :class="['nav-item', activeTab === 'cart' ? 'active' : '']"><span class="nav-icon">üõí</span>–ö–û–†–ó–ò–ù–ê</button>
        <button @click="activeTab = 'profile'" :class="['nav-item', activeTab === 'profile' ? 'active' : '']"><span class="nav-icon">üë§</span>–ü–†–û–§–ò–õ–¨</button>
    </nav>
</div>

<script>
    const tg = window.Telegram.WebApp;
    const { createApp } = Vue;

    createApp({
        data() {
            return {
                activeTab: 'catalog',
                currentCategory: '—Ö–∞–ª–∞—Ç—ã',
                categories: ['—Ö–∞–ª–∞—Ç—ã', '—Å–æ—Ä–æ—á–∫–∏'],
                selectedProduct: null,
                tempSize: 'S',
                deliveryMode: '',
                address: '',
                map: null,
                marker: null,
                form: { name: '', phone: '' },
                user: { id: '', first_name: '–ì–æ—Å—Ç—å', last_name: '', photo: '' },
                products: [
                    { id: 1, category: '—Ö–∞–ª–∞—Ç—ã', name: '–•–∞–ª–∞—Ç "–ë–µ–ª–æ–µ –û–±–ª–∞–∫–æ"', price: 4500, image: '111white.jpg', sizes: ['S','M','L'], desc: '–®–µ–ª–∫ –°–≤–µ—Ç–ª–∞–Ω–∏—è.' },
                    { id: 2, category: '—Ö–∞–ª–∞—Ç—ã', name: '–•–∞–ª–∞—Ç "–ö—Ä–∞—Å–Ω–∞—è –ó–∞—Ä—è"', price: 5200, image: '111red.jpg', sizes: ['M','L'], desc: '–ê—Ç–ª–∞—Å –°–≤–µ—Ç–ª–∞–Ω–∏—è.' },
                    { id: 3, category: '—Ö–∞–ª–∞—Ç—ã', name: '–•–∞–ª–∞—Ç "–ü–æ–ª–Ω–æ—á—å"', price: 4800, image: '111black.jpg', sizes: ['S','M','L'], desc: '–ß–µ—Ä–Ω—ã–π —à–µ–ª–∫.' }
                ],
                cart: JSON.parse(localStorage.getItem('cart')) || [],
                favorites: JSON.parse(localStorage.getItem('favs')) || []
            }
        },
        watch: {
            cart: { handler(v) { localStorage.setItem('cart', JSON.stringify(v)); }, deep: true },
            favorites: { handler(v) { localStorage.setItem('favs', JSON.stringify(v)); }, deep: true }
        },
        computed: {
            filteredProducts() { return this.products.filter(p => p.category === this.currentCategory) },
            favItems() { return this.products.filter(p => this.favorites.includes(p.id)) },
            totalSum() { return this.cart.reduce((s, i) => s + i.price, 0) },
            phoneError() {
                const p = this.form.phone.replace(/\D/g, '');
                if (p.length === 0) return false;
                const blacklist = ['99999', '00000', '11111', '12345'];
                return p.length < 10 || blacklist.some(b => p.includes(b));
            },
            isFormValid() { return this.form.phone && !this.phoneError && this.address && this.deliveryMode }
        },
        methods: {
            vibrate() { tg.HapticFeedback.impactOccurred('medium'); },
            toggleFav(p) { this.vibrate(); const idx = this.favorites.indexOf(p.id); idx > -1 ? this.favorites.splice(idx, 1) : this.favorites.push(p.id); },
            isFav(p) { return this.favorites.includes(p.id); },
            openProduct(p) { this.vibrate(); this.selectedProduct = p; this.tempSize = p.sizes[0]; },
            addToCart() { this.vibrate(); this.cart.push({...this.selectedProduct, size: this.tempSize, cartId: Date.now()}); this.selectedProduct = null; },
            removeFromCart(id) { this.cart = this.cart.filter(i => i.cartId !== id); },
            setDelivery(m) { this.vibrate(); this.deliveryMode = m; setTimeout(() => { this.initMap(); }, 100); },
            contactSupport() { tg.openTelegramLink('https://t.me/putunkeeva'); },
            initMap() {
                if (typeof DG !== 'undefined') {
                    if (this.map) this.map.remove();
                    this.map = DG.map('map', { center: [55.75, 37.61], zoom: 11, zoomControl: false });
                    this.map.on('click', (e) => {
                        this.vibrate();
                        const {lat, lng} = e.latlng;
                        if (this.marker) this.marker.setLatLng([lat, lng]); else this.marker = DG.marker([lat, lng]).addTo(this.map);
                        fetch(`https://catalog.api.2gis.com/3.0/items/geocode?lat=${lat}&lon=${lng}&fields=items.address&key=cab82c94-e619-42eb-9814-3361712feaf0`)
                        .then(r => r.json()).then(d => { if (d.result?.items[0]) this.address = d.result.items[0].address_name; });
                    });
                }
            },
            sendOrder() {
                const orderNum = new Date().toISOString().slice(0,10).replace(/-/g,'') + '-' + Math.floor(10000 + Math.random() * 90000);
                const data = { 
                    orderId: orderNum,
                    user: { name: this.user.first_name, phone: this.form.phone },
                    cart: this.cart,
                    total: this.totalSum,
                    address: this.address,
                    delivery: this.deliveryMode
                };
                tg.sendData(JSON.stringify(data));
                localStorage.removeItem('cart');
                tg.close();
            }
        },
        mounted() {
            tg.ready(); tg.expand();
            if (tg.initDataUnsafe?.user) {
                this.user = tg.initDataUnsafe.user;
                this.form.name = this.user.first_name;
            }
        }
    }).mount('#app');
</script>
</body>
</html>
