<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>SVETLANIA</title>
    <script src="https://unpkg.com/vue@3/dist/vue.global.prod.js"></script>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Ruslan+Display&display=swap" rel="stylesheet">
    
    <style>
        :root { --gold: #D4AF37; --bg: #fffaf0; --dark: #1a1a1a; }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; outline: none; }
        body { margin: 0; background: var(--bg); font-family: -apple-system, sans-serif; color: var(--dark); overflow-x: hidden; }
        
        .header { background: #fff; padding: 15px; text-align: center; border-bottom: 2px solid var(--gold); position: sticky; top: 0; z-index: 100; }
        .old-russian { font-family: 'Ruslan Display', cursive; color: var(--gold); font-size: 28px; margin: 0; text-transform: uppercase; letter-spacing: 2px; }
        
        .container { padding: 15px; padding-bottom: 120px; }
        
        /* –°–µ—Ç–∫–∞ —Ç–æ–≤–∞—Ä–æ–≤ */
        .products-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
        .card { background: #fff; border-radius: 20px; overflow: hidden; box-shadow: 0 4px 15px rgba(0,0,0,0.05); position: relative; border: 1px solid rgba(212, 175, 55, 0.1); }
        .card img { width: 100%; aspect-ratio: 3/4; object-fit: cover; display: block; }
        .card-info { padding: 12px; text-align: center; }
        .card-price { color: var(--gold); font-weight: 800; }

        .fav-btn { position: absolute; top: 10px; right: 10px; background: rgba(255,255,255,0.9); border: none; border-radius: 50%; width: 32px; height: 32px; display: flex; align-items: center; justify-content: center; font-size: 18px; color: #ccc; transition: 0.3s; }
        .fav-btn.active { color: #e74c3c; }

        /* –§–æ—Ä–º–∞ –≤–≤–æ–¥–∞ */
        .input-group { margin-bottom: 15px; text-align: left; }
        .input-group label { display: block; font-size: 12px; color: var(--gold); font-weight: bold; margin-bottom: 5px; margin-left: 5px; }
        .input-field { width: 100%; padding: 12px; border-radius: 12px; border: 1px solid #ddd; font-size: 14px; background: #fff; }
        .input-field:focus { border-color: var(--gold); }

        /* –ö–Ω–æ–ø–∫–∏ –∏ –Ω–∞–≤–∏–≥–∞—Ü–∏—è */
        .bottom-nav { position: fixed; bottom: 0; left: 0; right: 0; background: #fff; display: flex; justify-content: space-around; padding: 12px; border-top: 1px solid #eee; z-index: 1000; }
        .nav-item { border: none; background: none; color: #bbb; display: flex; flex-direction: column; align-items: center; font-size: 9px; font-weight: bold; }
        .nav-item.active { color: var(--gold); }
        .cat-btn { padding: 10px 20px; border-radius: 20px; border: 1px solid var(--gold); background: #fff; color: var(--gold); margin-right: 8px; white-space: nowrap; }
        .cat-btn.active { background: var(--gold); color: #fff; }

        .modal { position: fixed; inset: 0; background: #fff; z-index: 2000; overflow-y: auto; padding-bottom: 50px; }
        .close-btn { position: fixed; top: 20px; left: 20px; background: #fff; border-radius: 50%; width: 40px; height: 40px; border: 1px solid #eee; z-index: 2100; font-size: 20px; color: var(--gold); }
        .size-btn { padding: 10px 15px; border-radius: 10px; border: 1px solid var(--gold); background: #fff; margin: 5px; flex: 1; color: var(--gold); font-weight: bold; }
        .size-btn.active { background: var(--gold); color: #fff; }
        .btn-main { width: 100%; padding: 16px; background: var(--gold); color: #fff; border: none; border-radius: 15px; font-weight: bold; margin-top: 15px; cursor: pointer; }
        .btn-main:disabled { background: #ccc; }

        #map { width: 100%; height: 200px; border-radius: 15px; margin-top: 10px; border: 1px solid var(--gold); }
    </style>
</head>
<body>

<div id="app">
    <div class="header">
        <h1 class="old-russian">SVETLANIA</h1>
    </div>

    <div class="container">
        <div v-if="activeTab === 'catalog'">
            <div style="display: flex; overflow-x: auto; padding-bottom: 15px; scrollbar-width: none;">
                <button v-for="cat in categories" @click="currentCategory = cat" :class="['cat-btn', currentCategory === cat ? 'active' : '']">{{cat.toUpperCase()}}</button>
            </div>
            <div class="products-grid">
                <div v-for="p in filteredProducts" :key="p.id" class="card" @click="openProduct(p)">
                    <button class="fav-btn" @click.stop="toggleFav(p)" :class="{active: isFav(p)}">‚ù§</button>
                    <img :src="p.image">
                    <div class="card-info">
                        <div style="font-size: 11px; font-weight: bold;">{{p.name}}</div>
                        <div class="card-price">{{p.price}} ‚ÇΩ</div>
                    </div>
                </div>
            </div>
        </div>

        <div v-if="activeTab === 'favs'">
            <h2 class="old-russian" style="font-size: 20px;">–ò–∑–±—Ä–∞–Ω–Ω–æ–µ</h2>
            <div v-if="favItems.length === 0" style="text-align: center; margin-top: 50px; color: #999;">–¢—É—Ç –ø–æ–∫–∞ –ø—É—Å—Ç–æ</div>
            <div v-else class="products-grid">
                <div v-for="p in favItems" :key="p.id" class="card" @click="openProduct(p)">
                    <button class="fav-btn active" @click.stop="toggleFav(p)">‚ù§</button>
                    <img :src="p.image">
                    <div class="card-info">
                        <div>{{p.name}}</div>
                        <div class="card-price">{{p.price}} ‚ÇΩ</div>
                    </div>
                </div>
            </div>
        </div>

        <div v-if="activeTab === 'cart'">
            <h2 class="old-russian" style="font-size: 20px;">–û—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ –∑–∞–∫–∞–∑–∞</h2>
            <div v-if="cart.length === 0" style="text-align: center; margin-top: 50px; color: #999;">–ö–æ—Ä–∑–∏–Ω–∞ –ø—É—Å—Ç–∞</div>
            <div v-else>
                <div v-for="item in cart" :key="item.cartId" style="display: flex; gap: 10px; background: #fff; padding: 10px; border-radius: 12px; margin-bottom: 10px; align-items: center; border: 1px solid #eee;">
                    <img :src="item.image" style="width: 50px; height: 60px; object-fit: cover; border-radius: 8px;">
                    <div style="flex: 1; font-size: 12px;">
                        <b>{{item.name}}</b> ({{item.size}})<br>
                        <span style="color: var(--gold)">{{item.price}} ‚ÇΩ</span>
                    </div>
                    <button @click="removeFromCart(item.cartId)" style="border: none; background: none; color: #ccc;">‚úï</button>
                </div>

                <div style="background: #fff; padding: 15px; border-radius: 15px; margin-top: 20px; border: 1px solid #eee;">
                    <div class="input-group">
                        <label>–ò–ú–Ø</label>
                        <input class="input-field" v-model="form.firstName" placeholder="–í–≤–µ–¥–∏—Ç–µ –∏–º—è">
                    </div>
                    <div class="input-group">
                        <label>–§–ê–ú–ò–õ–ò–Ø</label>
                        <input class="input-field" v-model="form.lastName" placeholder="–í–≤–µ–¥–∏—Ç–µ —Ñ–∞–º–∏–ª–∏—é">
                    </div>
                    <div class="input-group">
                        <label>–¢–ï–õ–ï–§–û–ù</label>
                        <input class="input-field" v-model="form.phone" type="tel" placeholder="+7 (999) 000-00-00">
                    </div>
                    
                    <label style="font-size: 12px; color: var(--gold); font-weight: bold;">–î–û–°–¢–ê–í–ö–ê</label>
                    <div style="display: flex; gap: 5px; margin-top: 5px;">
                        <button v-for="m in ['–°–î–≠–ö', '–ü–æ—á—Ç–∞', '5post']" @click="setDelivery(m)" :class="['cat-btn', deliveryMode === m ? 'active' : '']" style="flex: 1; margin: 0; font-size: 10px; padding: 8px;">{{m}}</button>
                    </div>

                    <div v-if="deliveryMode">
                        <p style="font-size: 11px; margin-top: 10px;">üìç <b>–ê–¥—Ä–µ—Å:</b> {{address || '–ö–ª–∏–∫–Ω–∏—Ç–µ –Ω–∞ –∫–∞—Ä—Ç—É'}}</p>
                        <div id="map"></div>
                    </div>
                </div>

                <button class="btn-main" @click="sendOrder" :disabled="!isFormValid">–ó–ê–ö–ê–ó–ê–¢–¨: {{totalSum}} ‚ÇΩ</button>
            </div>
        </div>
    </div>

    <div v-if="selectedProduct" class="modal">
        <button class="close-btn" @click="selectedProduct = null">‚úï</button>
        <img :src="selectedProduct.image" style="width: 100%">
        <div style="padding: 20px;">
            <h2 class="old-russian">{{selectedProduct.name}}</h2>
            <div class="card-price" style="font-size: 20px;">{{selectedProduct.price}} ‚ÇΩ</div>
            <p style="font-size: 12px; color: #666; margin-top: 15px;">{{selectedProduct.desc}}</p>
            
            <p style="font-weight: bold; font-size: 12px; margin-top: 20px; color: var(--gold);">–í–´–ë–ï–†–ò–¢–ï –†–ê–ó–ú–ï–†:</p>
            <div style="display: flex;">
                <button v-for="s in selectedProduct.sizes" @click="tempSize = s; vibrate()" :class="['size-btn', tempSize === s ? 'active' : '']">{{s}}</button>
            </div>
            <button class="btn-main" @click="addToCart">–í –ö–û–†–ó–ò–ù–£</button>
        </div>
    </div>

    <nav class="bottom-nav">
        <button @click="activeTab = 'catalog'; vibrate()" :class="['nav-item', activeTab === 'catalog' ? 'active' : '']"><span class="nav-icon">üè∞</span>–ö–ê–¢–ê–õ–û–ì</button>
        <button @click="activeTab = 'favs'; vibrate()" :class="['nav-item', activeTab === 'favs' ? 'active' : '']"><span class="nav-icon">‚ù§</span>–ò–ó–ë–†–ê–ù–ù–û–ï</button>
        <button @click="activeTab = 'cart'; vibrate()" :class="['nav-item', activeTab === 'cart' ? 'active' : '']"><span class="nav-icon">üõí</span>–ö–û–†–ó–ò–ù–ê</button>
    </nav>
</div>

<script>
    const tg = window.Telegram.WebApp;
    const { createApp } = Vue;

    createApp({
        data() {
            return {
                activeTab: 'catalog',
                currentCategory: '—Ö–∞–ª–∞—Ç—ã',
                categories: ['—Ö–∞–ª–∞—Ç—ã', '—Å–æ—Ä–æ—á–∫–∏'],
                selectedProduct: null,
                tempSize: 'S',
                deliveryMode: '',
                address: '',
                map: null,
                marker: null,
                form: { firstName: '', lastName: '', phone: '' },
                user: { name: '–ì–æ—Å—Ç—å', photo: '' },
                products: [
                    { id: 1, category: '—Ö–∞–ª–∞—Ç—ã', name: '–•–∞–ª–∞—Ç "–ë–µ–ª–æ–µ –û–±–ª–∞–∫–æ"', price: 4500, image: '111white.jpg', sizes: ['S','M','L'], desc: '–ù–µ–∂–Ω—ã–π —à–µ–ª–∫ –°–≤–µ—Ç–ª–∞–Ω–∏—è.' },
                    { id: 2, category: '—Ö–∞–ª–∞—Ç—ã', name: '–•–∞–ª–∞—Ç "–ö—Ä–∞—Å–Ω–∞—è –ó–∞—Ä—è"', price: 5200, image: '111red.jpg', sizes: ['M','L'], desc: '–†–æ—Å–∫–æ—à–Ω—ã–π –∞—Ç–ª–∞—Å.' },
                    { id: 3, category: '—Ö–∞–ª–∞—Ç—ã', name: '–•–∞–ª–∞—Ç "–ü–æ–ª–Ω–æ—á—å"', price: 4800, image: '111black.jpg', sizes: ['S','M','L'], desc: '–ö–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–π —á–µ—Ä–Ω—ã–π.' },
                    { id: 4, category: '—Å–æ—Ä–æ—á–∫–∏', name: '–°–æ—Ä–æ—á–∫–∞ "–ö—Ä—É–∂–µ–≤–æ"', price: 2800, image: 'sorochka1.jpg', sizes: ['S','M'], desc: '–õ–µ–≥–∫–æ–µ –∫—Ä—É–∂–µ–≤–æ.' }
                ],
                cart: [],
                favorites: []
            }
        },
        computed: {
            filteredProducts() { return this.products.filter(p => p.category === this.currentCategory) },
            favItems() { return this.products.filter(p => this.favorites.includes(p.id)) },
            totalSum() { return this.cart.reduce((s, i) => s + i.price, 0) },
            isFormValid() { return this.form.firstName && this.form.phone && this.address }
        },
        methods: {
            vibrate() { tg.HapticFeedback.impactOccurred('medium'); },
            toggleFav(p) { this.vibrate(); const idx = this.favorites.indexOf(p.id); idx > -1 ? this.favorites.splice(idx, 1) : this.favorites.push(p.id); },
            isFav(p) { return this.favorites.includes(p.id); },
            openProduct(p) { this.vibrate(); this.selectedProduct = p; this.tempSize = p.sizes[0]; },
            addToCart() {
                this.vibrate();
                this.cart.push({...this.selectedProduct, size: this.tempSize, cartId: Date.now()});
                this.selectedProduct = null;
            },
            removeFromCart(id) { this.cart = this.cart.filter(i => i.cartId !== id); },
            setDelivery(m) { this.vibrate(); this.deliveryMode = m; this.$nextTick(() => this.initMap()); },
            initMap() {
                if (typeof dg === 'undefined') {
                    const s = document.createElement('script');
                    s.src = "https://maps.api.2gis.ru/2.0/loader.js?pkg=full";
                    s.onload = () => this.renderMap();
                    document.head.appendChild(s);
                } else { this.renderMap(); }
            },
            renderMap() {
                dg.loader.init(() => {
                    if (this.map) { this.map.remove(); this.map = null; }
                    this.map = new dg.Map('map', { center: [55.75, 37.61], zoom: 11, zoomControl: false });
                    this.marker = null;
                    this.map.on('click', (e) => {
                        this.vibrate();
                        const {lat, lng} = e.latlng;
                        if (this.marker) this.marker.setLatLng([lat, lng]); else this.marker = dg.marker([lat, lng]).addTo(this.map);
                        fetch(`https://catalog.api.2gis.com/3.0/items/geocode?lat=${lat}&lon=${lng}&fields=items.address&key=cab82c94-e619-42eb-9814-3361712feaf0`)
                        .then(r => r.json()).then(d => { if (d.result?.items[0]) this.address = d.result.items[0].address_name; });
                    });
                });
            },
            sendOrder() {
                this.vibrate();
                const data = {
                    user: this.form,
                    cart: this.cart,
                    total: this.totalSum,
                    delivery: this.deliveryMode,
                    address: this.address
                };
                tg.sendData(JSON.stringify(data));
                tg.close();
            }
        },
        mounted() {
            tg.ready();
            tg.expand();
            if (tg.initDataUnsafe?.user) {
                this.user.name = tg.initDataUnsafe.user.first_name;
                this.form.firstName = tg.initDataUnsafe.user.first_name;
                this.form.lastName = tg.initDataUnsafe.user.last_name || '';
                this.user.photo = tg.initDataUnsafe.user.photo_url || '';
            }
        }
    }).mount('#app');
</script>
</body>
</html>
