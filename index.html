<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>SVETLANIA</title>
    <script src="https://unpkg.com/vue@3/dist/vue.global.prod.js"></script>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://maps.api.2gis.ru/2.0/loader.js?pkg=full"></script>
    <link href="https://fonts.googleapis.com/css2?family=Ruslan+Display&display=swap" rel="stylesheet">
    
    <style>
        :root { --gold: #D4AF37; --bg: #ffffff; --dark: #1a1a1a; --gray: #8e8e93; --red: #e74c3c; --light-gold: rgba(212, 175, 55, 0.1); }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; outline: none; }
        body { margin: 0; background: var(--bg); font-family: -apple-system, sans-serif; color: var(--dark); overflow-x: hidden; }
        
        .header { background: #fff; padding: 15px; text-align: center; border-bottom: 1px solid var(--gold); position: sticky; top: 0; z-index: 100; }
        .old-russian { font-family: 'Ruslan Display', cursive; color: var(--gold); font-size: 24px; margin: 0; text-transform: uppercase; letter-spacing: 2px; }
        
        .container { padding: 15px; padding-bottom: 110px; }

        /* –ö–ê–¢–ï–ì–û–†–ò–ò */
        .cat-row { display: flex; gap: 8px; margin-bottom: 20px; overflow-x: auto; padding-bottom: 5px; scrollbar-width: none; }
        .cat-tab { padding: 10px 20px; border-radius: 25px; border: 1.5px solid var(--gold); background: #fff; color: var(--gold); font-size: 12px; font-weight: bold; white-space: nowrap; }
        .cat-tab.active { background: var(--gold); color: #fff; }

        /* –ö–ê–†–¢–û–ß–ö–ê –¢–û–í–ê–†–ê */
        .products-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
        .card { background: #fff; border-radius: 20px; overflow: hidden; border: 1px solid #eee; position: relative; display: flex; flex-direction: column; }
        
        .slider-wrapper { position: relative; width: 100%; aspect-ratio: 3/4; overflow: hidden; }
        .slider-inner { display: flex; overflow-x: auto; scroll-snap-type: x mandatory; scrollbar-width: none; height: 100%; }
        .slider-inner img { width: 100%; height: 100%; object-fit: cover; scroll-snap-align: start; flex-shrink: 0; }

        /* –ü–†–û–ó–†–ê–ß–ù–û–ï –°–ï–†–î–¶–ï */
        .fav-heart { position: absolute; top: 10px; right: 10px; z-index: 10; background: rgba(255,255,255,0.2); backdrop-filter: blur(8px); border: 1px solid rgba(255,255,255,0.3); border-radius: 50%; width: 34px; height: 34px; display: flex; align-items: center; justify-content: center; }
        .fav-heart svg { width: 18px; height: 18px; fill: none; stroke: white; stroke-width: 2px; }
        .fav-heart.active svg { fill: var(--red); stroke: var(--red); }

        .card-info { padding: 12px; text-align: center; }
        .card-price { color: var(--gold); font-weight: 800; font-size: 16px; margin-bottom: 10px; }
        
        /* –ö–†–£–ü–ù–´–ï –†–ê–ó–ú–ï–†–´ */
        .size-btns { display: flex; justify-content: center; gap: 6px; margin-bottom: 12px; }
        .s-btn { flex: 1; padding: 12px 0; border: 1.5px solid #eee; border-radius: 10px; font-size: 14px; font-weight: bold; background: #fff; color: var(--dark); }
        .s-btn.active { border-color: var(--gold); background: var(--light-gold); color: var(--gold); }

        .buy-btn { width: 100%; padding: 14px; background: var(--gold); color: #fff; border: none; border-radius: 12px; font-size: 11px; font-weight: 800; text-transform: uppercase; }

        /* –ù–ê–í–ò–ì–ê–¶–ò–Ø (–ò–°–ü–†–ê–í–õ–ï–ù–ù–´–ï –ò–ö–û–ù–ö–ò) */
        .bottom-nav { position: fixed; bottom: 0; left: 0; right: 0; background: #fff; display: flex; justify-content: space-around; padding: 10px 0 25px 0; border-top: 1px solid #eee; z-index: 1000; }
        .nav-item { border: none; background: none; color: #b0b0b0; display: flex; flex-direction: column; align-items: center; font-size: 11px; gap: 5px; width: 25%; }
        .nav-item.active { color: var(--gold); }
        .nav-item svg { width: 26px; height: 26px; fill: none; stroke: currentColor; stroke-width: 1.8; stroke-linecap: round; stroke-linejoin: round; }

        /* –û–ö–ù–û –£–°–ü–ï–•–ê */
        .order-success { position: fixed; inset: 0; background: rgba(0,0,0,0.85); z-index: 3000; display: flex; align-items: center; justify-content: center; padding: 20px; }
        .success-card { background: #fff; border-radius: 25px; padding: 30px; text-align: center; width: 100%; max-width: 320px; }
        .order-num-box { font-size: 22px; font-weight: 900; color: var(--gold); margin: 15px 0; padding: 10px; border: 2px dashed var(--gold); border-radius: 10px; }

        #map { width: 100%; height: 200px; border-radius: 15px; margin-top: 10px; border: 1px solid var(--gold); }
        .input-c { width: 100%; padding: 14px; border-radius: 12px; border: 1px solid #eee; font-size: 15px; background: #f9f9f9; margin-bottom: 10px; }
    </style>
</head>
<body>

<div id="app">
    <div class="header"><h1 class="old-russian">SVETLANIA</h1></div>

    <div class="container">
        <div v-if="activeTab === 'catalog'">
            <div class="cat-row">
                <button v-for="c in categories" @click="currentCat = c; vibrate()" :class="['cat-tab', currentCat === c ? 'active' : '']">{{c.toUpperCase()}}</button>
            </div>
            <div class="products-grid">
                <div v-for="p in filteredProducts" :key="p.id" class="card">
                    <button class="fav-heart" @click.stop="toggleFav(p)" :class="{active: isFav(p)}">
                        <svg viewBox="0 0 24 24"><path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"></path></svg>
                    </button>
                    <div class="slider-wrapper">
                        <div class="slider-inner"><img :src="p.images[0]"></div>
                    </div>
                    <div class="card-info">
                        <div style="font-size: 13px; font-weight: 600; margin-bottom:5px;">{{p.name}}</div>
                        <div class="card-price">{{p.price}} ‚ÇΩ</div>
                        <div class="size-btns">
                            <button v-for="s in p.sizes" @click="p.selS = s; vibrate()" :class="['s-btn', p.selS === s ? 'active' : '']">{{s}}</button>
                        </div>
                        <button class="buy-btn" @click="addToCart(p)">–í –ö–û–†–ó–ò–ù–£</button>
                    </div>
                </div>
            </div>
        </div>

        <div v-if="activeTab === 'cart'">
            <h2 class="old-russian" style="font-size: 18px;">–í–∞—à –∑–∞–∫–∞–∑</h2>
            <div v-if="cart.length === 0" style="text-align: center; padding: 50px 0; color: var(--gray);">–ö–æ—Ä–∑–∏–Ω–∞ –ø—É—Å—Ç–∞</div>
            <div v-else>
                <div v-for="item in cart" :key="item.cartId" style="display:flex; gap:15px; margin-bottom:15px; border-bottom:1px solid #eee; padding-bottom:15px;">
                    <img :src="item.img" style="width:60px; height:80px; object-fit:cover; border-radius:12px;">
                    <div style="flex:1;">
                        <div style="font-size:14px; font-weight:600;">{{item.name}}</div>
                        <div style="font-size:12px; color:var(--gray);">–†–∞–∑–º–µ—Ä: {{item.size}}</div>
                        <div style="color:var(--gold); font-weight:700; margin-top:5px;">{{item.price}} ‚ÇΩ</div>
                    </div>
                    <button @click="removeC(item.cartId)" style="border:none; background:none; font-size:20px; color:#ccc;">‚úï</button>
                </div>

                <div style="margin-top: 25px;">
                    <input class="input-c" v-model="form.name" placeholder="–ò–º—è –∏ –§–∞–º–∏–ª–∏—è">
                    <input class="input-c" v-model="form.phone" placeholder="–¢–µ–ª–µ—Ñ–æ–Ω" type="tel">
                    
                    <div style="display:flex; gap:8px; margin: 15px 0;">
                        <button v-for="d in ['5post', '–°–î–≠–ö', '–ü–æ—á—Ç–∞']" @click="deliv = d; vibrate(); initMap()" :class="['cat-tab', deliv === d ? 'active' : '']" style="flex:1;">{{d}}</button>
                    </div>
                    <div v-show="deliv">
                        <div style="font-size:12px; margin:10px 0;">üìç {{address || '–í—ã–±–µ—Ä–∏—Ç–µ –Ω–∞ –∫–∞—Ä—Ç–µ'}}</div>
                        <div id="map"></div>
                    </div>
                </div>
                <button class="buy-btn" style="height:60px; margin-top:20px; font-size:16px;" @click="send" :disabled="!isValid">–û–§–û–†–ú–ò–¢–¨: {{total}} ‚ÇΩ</button>
            </div>
        </div>

        <div v-if="activeTab === 'favs'">
            <h2 class="old-russian" style="font-size: 18px;">–ò–∑–±—Ä–∞–Ω–Ω–æ–µ</h2>
            <div v-if="favItems.length === 0" style="text-align: center; padding: 50px 0; color: var(--gray);">–ó–¥–µ—Å—å –ø–æ–∫–∞ –ø—É—Å—Ç–æ</div>
            <div class="products-grid">
                <div v-for="p in favItems" :key="p.id" class="card">
                    <img :src="p.images[0]" style="width:100%; aspect-ratio:3/4; object-fit:cover;">
                    <div class="card-info">
                        <div class="card-price">{{p.price}} ‚ÇΩ</div>
                        <button class="buy-btn" @click="addToCart(p)">–í –ö–û–†–ó–ò–ù–£</button>
                    </div>
                </div>
            </div>
        </div>

        <div v-if="activeTab === 'profile'">
            <div style="text-align: center; padding: 30px 0;">
                <img :src="user.photo || 'https://cdn-icons-png.flaticon.com/512/149/149071.png'" style="width: 80px; height: 80px; border-radius: 50%; border: 2px solid var(--gold);">
                <h2 style="margin-top: 10px;">{{user.first_name}}</h2>
            </div>
            <div v-if="history.length" style="padding: 0 10px;">
                <h3 class="old-russian" style="font-size:16px; margin-bottom:15px;">–ú–æ–∏ –∑–∞–∫–∞–∑—ã:</h3>
                <div v-for="h in history" style="background:#f9f9f9; padding:15px; border-radius:15px; margin-bottom:10px; border:1px solid #eee;">
                    <div style="display:flex; justify-content:space-between; font-weight:700;">
                        <span>–ó–∞–∫–∞–∑ #{{h.id}}</span>
                        <span>{{h.total}} ‚ÇΩ</span>
                    </div>
                    <div style="font-size:11px; color:var(--gray); margin-top:5px;">{{h.date}}</div>
                </div>
            </div>
        </div>
    </div>

    <div v-if="showSuccess" class="order-success">
        <div class="success-card">
            <div style="font-size:45px;">üëë</div>
            <h2 class="old-russian" style="font-size:20px; margin: 10px 0;">–ó–∞–∫–∞–∑ –ø—Ä–∏–Ω—è—Ç!</h2>
            <p style="font-size:14px; color: var(--gray);">–ó–∞–ø–∏—à–∏—Ç–µ –≤–∞—à –Ω–æ–º–µ—Ä –∑–∞–∫–∞–∑–∞:</p>
            <div class="order-num-box">{{lastOrderNum}}</div>
            <button class="buy-btn" @click="showSuccess = false">–í–ï–†–ù–£–¢–¨–°–Ø</button>
        </div>
    </div>

    <nav class="bottom-nav">
        <button @click="activeTab = 'catalog'; vibrate()" :class="['nav-item', activeTab === 'catalog' ? 'active' : '']">
            <svg viewBox="0 0 24 24"><path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path><polyline points="9 22 9 12 15 12 15 22"></polyline></svg>
            <span>–ö–∞—Ç–∞–ª–æ–≥</span>
        </button>
        <button @click="activeTab = 'favs'; vibrate()" :class="['nav-item', activeTab === 'favs' ? 'active' : '']">
            <svg viewBox="0 0 24 24"><path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"></path></svg>
            <span>–ò–∑–±—Ä–∞–Ω–Ω–æ–µ</span>
        </button>
        <button @click="activeTab = 'cart'; vibrate()" :class="['nav-item', activeTab === 'cart' ? 'active' : '']">
            <svg viewBox="0 0 24 24"><path d="M6 2L3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4Z"></path><path d="M3 6h18"></path><path d="M16 10a4 4 0 0 1-8 0"></path></svg>
            <span>–ö–æ—Ä–∑–∏–Ω–∞</span>
        </button>
        <button @click="activeTab = 'profile'; vibrate()" :class="['nav-item', activeTab === 'profile' ? 'active' : '']">
            <svg viewBox="0 0 24 24"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path><circle cx="12" cy="7" r="4"></circle></svg>
            <span>–ü—Ä–æ—Ñ–∏–ª—å</span>
        </button>
    </nav>
</div>

<script>
    const tg = window.Telegram.WebApp;
    const { createApp } = Vue;

    createApp({
        data() {
            return {
                activeTab: 'catalog',
                currentCat: '—Ö–∞–ª–∞—Ç—ã',
                categories: ['—Ö–∞–ª–∞—Ç—ã', '—Å–æ—Ä–æ—á–∫–∏'],
                showSuccess: false,
                lastOrderNum: '',
                deliv: '',
                address: '',
                user: { first_name: '–ì–æ—Å—Ç—å', photo: '' },
                form: { name: '', phone: '' },
                products: [
                    { id: 1, category: '—Ö–∞–ª–∞—Ç—ã', name: '–•–∞–ª–∞—Ç "–ë–µ–ª–æ–µ –û–±–ª–∞–∫–æ"', price: 4500, images: ['111white.jpg'], sizes: ['S','M','L'], selS: 'S' },
                    { id: 2, category: '—Ö–∞–ª–∞—Ç—ã', name: '–•–∞–ª–∞—Ç "–ö—Ä–∞—Å–Ω–∞—è –ó–∞—Ä—è"', price: 5200, images: ['111red.jpg'], sizes: ['M','L'], selS: 'M' },
                    { id: 3, category: '—Ö–∞–ª–∞—Ç—ã', name: '–•–∞–ª–∞—Ç "–ü–æ–ª–Ω–æ—á—å"', price: 4800, images: ['111black.jpg'], sizes: ['S','M','L'], selS: 'S' },
                    { id: 4, category: '—Å–æ—Ä–æ—á–∫–∏', name: '–°–æ—Ä–æ—á–∫–∞ "–ê–º–µ—Ç–∏—Å—Ç"', price: 3500, images: ['111red.jpg'], sizes: ['S','M'], selS: 'S' }
                ],
                cart: JSON.parse(localStorage.getItem('sv_cart') || '[]'),
                favs: JSON.parse(localStorage.getItem('sv_favs') || '[]'),
                history: JSON.parse(localStorage.getItem('sv_history') || '[]')
            }
        },
        computed: {
            filteredProducts() { return this.products.filter(p => p.category === this.currentCat) },
            favItems() { return this.products.filter(p => this.favs.includes(p.id)) },
            total() { return this.cart.reduce((s, i) => s + i.price, 0) },
            isValid() { return this.form.name.length > 2 && this.form.phone.length > 10 && this.address; }
        },
        methods: {
            vibrate() { tg.HapticFeedback.impactOccurred('medium'); },
            toggleFav(p) {
                this.vibrate();
                const i = this.favs.indexOf(p.id);
                i > -1 ? this.favs.splice(i, 1) : this.favs.push(p.id);
                localStorage.setItem('sv_favs', JSON.stringify(this.favs));
            },
            isFav(p) { return this.favs.includes(p.id); },
            addToCart(p) {
                this.vibrate();
                this.cart.push({ cartId: Date.now(), name: p.name, price: p.price, size: p.selS, img: p.images[0] });
                localStorage.setItem('sv_cart', JSON.stringify(this.cart));
                tg.showScanQrPopup({ text: "–î–æ–±–∞–≤–ª–µ–Ω–æ –≤ –∫–æ—Ä–∑–∏–Ω—É" }); setTimeout(() => tg.closeScanQrPopup(), 1000);
            },
            removeC(id) { 
                this.cart = this.cart.filter(i => i.cartId !== id);
                localStorage.setItem('sv_cart', JSON.stringify(this.cart));
            },
            initMap() {
                setTimeout(() => {
                    const map = DG.map('map', { center: [55.75, 37.61], zoom: 11, zoomControl: false });
                    map.on('click', (e) => {
                        this.vibrate();
                        fetch(`https://catalog.api.2gis.com/3.0/items/geocode?lat=${e.latlng.lat}&lon=${e.latlng.lng}&fields=items.address&key=cab82c94-e619-42eb-9814-3361712feaf0`)
                        .then(r => r.json()).then(d => {
                            if (d.result?.items?.length > 0) this.address = d.result.items[0].address_name;
                        });
                    });
                }, 100);
            },
            send() {
                this.vibrate();
                // –ì–ï–ù–ï–†–ê–¶–ò–Ø –ù–û–ú–ï–†–ê: –î–ê–¢–ê (–î–î–ú–ú–ì–ì) + 5 –¶–ò–§–†
                const datePart = new Date().toLocaleDateString('ru-RU').replace(/\./g, '').slice(0, 4) + new Date().getFullYear().toString().slice(-2);
                const randomPart = Math.floor(10000 + Math.random() * 89999);
                this.lastOrderNum = `${datePart}-${randomPart}`;
                
                const orderData = { id: this.lastOrderNum, user: this.form, cart: this.cart, total: this.total, address: this.address, date: new Date().toLocaleString() };
                
                this.history.unshift({ id: this.lastOrderNum, total: this.total, date: new Date().toLocaleDateString() });
                localStorage.setItem('sv_history', JSON.stringify(this.history));
                
                tg.sendData(JSON.stringify(orderData));
                this.showSuccess = true;
                this.cart = [];
                localStorage.removeItem('sv_cart');
            }
        },
        mounted() {
            tg.ready(); tg.expand();
            if (tg.initDataUnsafe?.user) {
                this.user = { first_name: tg.initDataUnsafe.user.first_name, photo: tg.initDataUnsafe.user.photo_url };
            }
        }
    }).mount('#app');
</script>
</body>
</html>
