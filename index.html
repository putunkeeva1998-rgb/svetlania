<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>SVETLANIA</title>
    <script src="https://unpkg.com/vue@3/dist/vue.global.prod.js"></script>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Ruslan+Display&display=swap" rel="stylesheet">
    
    <style>
        :root { --gold: #D4AF37; --bg: #fffaf0; --text: #2c2c2c; }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body { margin: 0; background: var(--bg); font-family: -apple-system, system-ui, sans-serif; color: var(--text); }
        
        /* –®–∞–ø–∫–∞ */
        .header { background: #fff; padding: 15px; text-align: center; border-bottom: 2px solid var(--gold); position: sticky; top: 0; z-index: 100; }
        .old-russian { font-family: 'Ruslan Display', cursive; color: var(--gold); font-size: 26px; margin: 0; text-transform: uppercase; }
        
        .container { padding: 12px; padding-bottom: 100px; }
        
        /* –ö–Ω–æ–ø–∫–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–π */
        .categories-nav { display: flex; gap: 8px; overflow-x: auto; margin-bottom: 15px; padding: 5px 0; scrollbar-width: none; }
        .categories-nav::-webkit-scrollbar { display: none; }
        .cat-btn { padding: 8px 22px; border-radius: 20px; border: 1px solid var(--gold); background: #fff; color: var(--gold); font-weight: bold; font-size: 13px; white-space: nowrap; transition: 0.2s; }
        .cat-btn.active { background: var(--gold); color: #fff; box-shadow: 0 4px 10px rgba(212, 175, 55, 0.3); }

        /* –°–µ—Ç–∫–∞ —Ç–æ–≤–∞—Ä–æ–≤ */
        .products-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
        .card { background: #fff; border-radius: 18px; overflow: hidden; box-shadow: 0 3px 10px rgba(0,0,0,0.05); position: relative; border: 1px solid rgba(212, 175, 55, 0.1); }
        .card img { width: 100%; aspect-ratio: 3/4; object-fit: cover; display: block; background: #fdfdfd; }
        .card-info { padding: 10px; text-align: center; }
        .card-name { font-size: 11px; font-weight: 600; margin-bottom: 4px; text-transform: uppercase; letter-spacing: 0.5px; }
        .card-price { color: var(--gold); font-weight: 800; font-size: 14px; }
        .fav-btn { position: absolute; top: 8px; right: 8px; background: rgba(255,255,255,0.8); border: none; border-radius: 50%; width: 30px; height: 30px; display: flex; align-items: center; justify-content: center; font-size: 16px; color: #ccc; }
        .fav-btn.active { color: #e74c3c; }

        /* –ù–∏–∂–Ω–µ–µ –º–µ–Ω—é */
        .bottom-nav { position: fixed; bottom: 0; left: 0; right: 0; background: #fff; display: flex; justify-content: space-around; padding: 12px; border-top: 1px solid #eee; z-index: 1000; }
        .nav-item { border: none; background: none; color: #aaa; display: flex; flex-direction: column; align-items: center; font-size: 9px; font-weight: 800; letter-spacing: 1px; }
        .nav-item.active { color: var(--gold); }
        .nav-icon { font-size: 22px; margin-bottom: 4px; }

        /* –ú–æ–¥–∞–ª–∫–∞ (–ö–∞—Ä—Ç–æ—á–∫–∞ —Ç–æ–≤–∞—Ä–∞) */
        .modal { position: fixed; inset: 0; background: #fff; z-index: 2000; overflow-y: auto; padding: 0; }
        .close-btn { position: fixed; top: 15px; left: 15px; background: rgba(255,255,255,0.9); border-radius: 50%; width: 40px; height: 40px; border: 1px solid #eee; z-index: 2010; font-size: 20px; font-weight: bold; color: var(--gold); }
        .modal-img { width: 100%; aspect-ratio: 3/4; object-fit: cover; }
        .modal-content { padding: 25px; }
        .size-grid { display: flex; gap: 10px; margin: 15px 0; }
        .size-btn { flex: 1; padding: 12px; border-radius: 12px; border: 1px solid var(--gold); background: #fff; color: var(--gold); font-weight: bold; }
        .size-btn.active { background: var(--gold); color: #fff; }
        .btn-buy { width: 100%; padding: 18px; background: var(--gold); color: #fff; border: none; border-radius: 15px; font-weight: bold; font-size: 16px; box-shadow: 0 5px 15px rgba(212, 175, 55, 0.4); margin-top: 20px; }

        /* –ö–∞—Ä—Ç–∞ */
        #map { width: 100%; height: 220px; border-radius: 15px; margin-top: 15px; border: 2px solid var(--gold); }
    </style>
</head>
<body>

<div id="app">
    <div class="header">
        <h1 class="old-russian">SVETLANIA</h1>
    </div>

    <div class="container">
        <div v-if="activeTab === 'catalog'">
            <div class="categories-nav">
                <button v-for="cat in categories" :key="cat" 
                        @click="currentCategory = cat; vibrate()" 
                        :class="['cat-btn', currentCategory === cat ? 'active' : '']">
                    {{ cat.toUpperCase() }}
                </button>
            </div>
            
            <div class="products-grid">
                <div v-for="p in filteredProducts" :key="p.id" class="card" @click="openProduct(p)">
                    <button class="fav-btn" @click.stop="toggleFav(p)" :class="{active: isFav(p)}">‚ù§</button>
                    <img :src="p.image" loading="lazy">
                    <div class="card-info">
                        <div class="card-name">{{ p.name }}</div>
                        <div class="card-price">{{ p.price }} ‚ÇΩ</div>
                    </div>
                </div>
            </div>
        </div>

        <div v-if="activeTab === 'cart'" style="padding-top: 10px;">
            <h2 class="old-russian" style="font-size: 22px; margin-bottom: 20px;">–í–∞—à–∞ –∫–æ—Ä–∑–∏–Ω–∞</h2>
            <div v-if="cart.length === 0" style="text-align: center; color: #999; margin-top: 60px;">–ü–æ–∫–∞ –ø—É—Å—Ç–æ...</div>
            <div v-else>
                <div v-for="item in cart" :key="item.cartId" style="display: flex; gap: 15px; background: #fff; padding: 12px; border-radius: 15px; margin-bottom: 12px; align-items: center;">
                    <img :src="item.image" style="width: 70px; height: 90px; object-fit: cover; border-radius: 10px;">
                    <div style="flex: 1;">
                        <div style="font-weight: bold; font-size: 14px; text-transform: uppercase;">{{ item.name }}</div>
                        <div style="font-size: 12px; color: #777; margin: 4px 0;">–†–∞–∑–º–µ—Ä: {{ item.size }}</div>
                        <div class="card-price">{{ item.price }} ‚ÇΩ</div>
                    </div>
                    <button @click="removeFromCart(item.cartId)" style="border: none; background: none; color: #ddd; font-size: 20px;">‚úï</button>
                </div>

                <div style="margin-top: 30px; background: #fff; padding: 15px; border-radius: 20px;">
                    <p style="font-weight: bold; font-size: 12px; color: #999; text-transform: uppercase; margin-bottom: 10px;">–î–æ—Å—Ç–∞–≤–∫–∞:</p>
                    <div style="display: flex; gap: 8px;">
                        <button v-for="m in ['5post', '–°–î–≠–ö', '–ü–æ—á—Ç–∞']" @click="setDelivery(m)" :class="['cat-btn', deliveryMode === m ? 'active' : '']" style="flex: 1;">{{m}}</button>
                    </div>
                    <div v-if="deliveryMode">
                        <p style="font-size: 13px; margin-top: 15px;">üìç <b>–ê–¥—Ä–µ—Å:</b> {{ address || '–ù–∞–∂–º–∏—Ç–µ –Ω–∞ –∫–∞—Ä—Ç—É' }}</p>
                        <div id="map"></div>
                    </div>
                </div>
                <button class="btn-buy" @click="sendOrder" :disabled="!address">–û–§–û–†–ú–ò–¢–¨ –†–ê–°–ß–ï–¢: {{ totalSum }} ‚ÇΩ</button>
            </div>
        </div>

        <div v-if="activeTab === 'profile'" style="text-align: center; padding-top: 40px;">
            <img :src="user.photo" style="width: 110px; height: 110px; border-radius: 50%; border: 4px solid var(--gold); box-shadow: 0 5px 20px rgba(212,175,55,0.2);">
            <h3 class="old-russian" style="margin-top: 20px;">{{ user.name }}</h3>
            <div style="margin-top: 50px; display: flex; flex-direction: column; gap: 10px;">
                <button class="btn-buy" style="background: #fff; color: var(--gold); border: 1px solid var(--gold); box-shadow: none;" @click="tg.openTelegramLink('https://t.me/putunkeeva')">–ù–ê–ü–ò–°–ê–¢–¨ –í –ü–û–î–î–ï–†–ñ–ö–£</button>
            </div>
        </div>
    </div>

    <div v-if="selectedProduct" class="modal">
        <button class="close-btn" @click="selectedProduct = null">‚úï</button>
        <img :src="selectedProduct.image" class="modal-img">
        <div class="modal-content">
            <h2 class="old-russian" style="font-size: 24px;">{{ selectedProduct.name }}</h2>
            <div class="card-price" style="font-size: 26px; margin: 10px 0;">{{ selectedProduct.price }} ‚ÇΩ</div>
            
            <p style="font-size: 12px; color: #999; text-transform: uppercase; margin-top: 25px; font-weight: bold;">–í—ã–±–µ—Ä–∏—Ç–µ —Ä–∞–∑–º–µ—Ä:</p>
            <div class="size-grid">
                <button v-for="s in selectedProduct.sizes" @click="tempSize = s; vibrate()" :class="['size-btn', tempSize === s ? 'active' : '']">{{s}}</button>
            </div>

            <p style="color: #666; font-size: 14px; line-height: 1.6; margin-top: 25px;">{{ selectedProduct.desc }}</p>
            <button class="btn-buy" @click="addToCart">–î–û–ë–ê–í–ò–¢–¨ –í –ö–û–†–ó–ò–ù–£</button>
        </div>
    </div>

    <nav class="bottom-nav">
        <button @click="activeTab = 'catalog'; vibrate()" :class="['nav-item', activeTab === 'catalog' ? 'active' : '']">
            <span class="nav-icon">üèØ</span>–ö–ê–¢–ê–õ–û–ì
        </button>
        <button @click="activeTab = 'cart'; vibrate()" :class="['nav-item', activeTab === 'cart' ? 'active' : '']">
            <span class="nav-icon">üõí</span>–ö–û–†–ó–ò–ù–ê
        </button>
        <button @click="activeTab = 'profile'; vibrate()" :class="['nav-item', activeTab === 'profile' ? 'active' : '']">
            <span class="nav-icon">üë§</span>–ü–†–û–§–ò–õ–¨
        </button>
    </nav>
</div>

<script>
    const tg = window.Telegram.WebApp;
    const { createApp } = Vue;

    createApp({
        data() {
            return {
                activeTab: 'catalog',
                currentCategory: '—Ö–∞–ª–∞—Ç—ã',
                categories: ['—Ö–∞–ª–∞—Ç—ã', '—Å–æ—Ä–æ—á–∫–∏'],
                selectedProduct: null,
                tempSize: 'S',
                deliveryMode: '',
                address: '',
                map: null,
                user: { name: '–ì–æ—Å—Ç—å', photo: 'https://cdn-icons-png.flaticon.com/512/1144/1144760.png' },
                
                // --- –í–ê–® –ö–ê–¢–ê–õ–û–ì –¢–û–í–ê–†–û–í ---
                // –ü—Ä–æ—Å—Ç–æ –º–µ–Ω—è–π—Ç–µ —Ç–µ–∫—Å—Ç –∏ –Ω–∞–∑–≤–∞–Ω–∏—è –∫–∞—Ä—Ç–∏–Ω–æ–∫ –∑–¥–µ—Å—å
                products: [
                    { 
                        id: 1, 
                        category: '—Ö–∞–ª–∞—Ç—ã', 
                        name: '–•–∞–ª–∞—Ç "–ë–µ–ª–æ–µ –û–±–ª–∞–∫–æ"', 
                        price: 4500, 
                        image: '111white.jpg', // –ò–º—è —Ñ–∞–π–ª–∞ –Ω–∞ GitHub
                        sizes: ['S', 'M', 'L'], 
                        desc: '–ù–µ–∂–Ω–µ–π—à–∏–π —à–µ–ª–∫ –∏ —Ä—É—á–Ω–∞—è –æ—Ç–¥–µ–ª–∫–∞ –¥–ª—è –≤–∞—à–µ–≥–æ —É—é—Ç–∞.' 
                    },
                    { 
                        id: 2, 
                        category: '—Ö–∞–ª–∞—Ç—ã', 
                        name: '–•–∞–ª–∞—Ç "–ö—Ä–∞—Å–Ω–∞—è –ó–∞—Ä—è"', 
                        price: 5200, 
                        image: '111red.jpg', // –ò–º—è —Ñ–∞–π–ª–∞ –Ω–∞ GitHub
                        sizes: ['S', 'M', 'L'], 
                        desc: '–†–æ—Å–∫–æ—à–Ω—ã–π –∞—Ç–ª–∞—Å–Ω—ã–π —Ö–∞–ª–∞—Ç –≤ –≥–ª—É–±–æ–∫–æ–º –∫—Ä–∞—Å–Ω–æ–º —Ü–≤–µ—Ç–µ.' 
                    },
                    { 
                        id: 3, 
                        category: '—Å–æ—Ä–æ—á–∫–∏', 
                        name: '–°–æ—Ä–æ—á–∫–∞ "–ö—Ä—É–∂–µ–≤–æ"', 
                        price: 2800, 
                        image: '111black.jpg', 
                        sizes: ['S', 'M'], 
                        desc: '–õ–µ–≥–∫–∞—è –∏ —Å–æ–±–ª–∞–∑–Ω–∏—Ç–µ–ª—å–Ω–∞—è —Å–æ—Ä–æ—á–∫–∞ —Å –∫—Ä—É–∂–µ–≤–Ω–æ–π –≤—Å—Ç–∞–≤–∫–æ–π.' 
                    }
                ],
                cart: [],
                favorites: []
            }
        },
        computed: {
            filteredProducts() { return this.products.filter(p => p.category === this.currentCategory) },
            totalSum() { return this.cart.reduce((s, i) => s + i.price, 0) }
        },
        methods: {
            vibrate() { tg.HapticFeedback.impactOccurred('medium'); },
            openProduct(p) { this.vibrate(); this.selectedProduct = p; this.tempSize = p.sizes[0]; },
            toggleFav(p) { this.vibrate(); const i = this.favorites.indexOf(p.id); i > -1 ? this.favorites.splice(i, 1) : this.favorites.push(p.id); },
            isFav(p) { return this.favorites.includes(p.id); },
            
            addToCart() {
                this.vibrate();
                this.cart.push({...this.selectedProduct, size: this.tempSize, cartId: Date.now()});
                this.selectedProduct = null;
                tg.MainButton.setText('–ü–ï–†–ï–ô–¢–ò –í –ö–û–†–ó–ò–ù–£').show().onClick(() => { this.activeTab = 'cart'; tg.MainButton.hide(); });
            },
            removeFromCart(id) { this.vibrate(); this.cart = this.cart.filter(i => i.cartId !== id); },
            
            setDelivery(m) {
                this.vibrate();
                this.deliveryMode = m;
                if (!window.dg) {
                    const s = document.createElement('script');
                    s.src = "https://maps.api.2gis.ru/2.0/loader.js?pkg=full";
                    s.onload = () => this.initMap();
                    document.head.appendChild(s);
                } else {
                    this.initMap();
                }
            },
            initMap() {
                dg.loader.init(() => {
                    setTimeout(() => {
                        this.map = new dg.Map('map', { center: [55.75, 37.61], zoom: 11 });
                        this.map.on('click', (e) => {
                            this.vibrate();
                            const {lat, lng} = e.latlng;
                            fetch(`https://catalog.api.2gis.com/3.0/items/geocode?lat=${lat}&lon=${lng}&fields=items.address&key=cab82c94-e619-42eb-9814-3361712feaf0`)
                            .then(r => r.json()).then(d => {
                                if (d.result?.items[0]) this.address = d.result.items[0].address_name;
                            });
                        });
                    }, 100);
                });
            },
            sendOrder() {
                this.vibrate();
                const data = {
                    items: this.cart,
                    total: this.totalSum,
                    address: this.address,
                    method: this.deliveryMode
                };
                tg.sendData(JSON.stringify(data));
            }
        },
        mounted() {
            tg.ready();
            tg.expand();
            if (tg.initDataUnsafe?.user) {
                this.user.name = tg.initDataUnsafe.user.first_name;
                this.user.photo = tg.initDataUnsafe.user.photo_url || this.user.photo;
            }
        }
    }).mount('#app');
</script>
</body>
</html>
