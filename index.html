
<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>SVETLANIA</title>
    <script src="https://unpkg.com/vue@3/dist/vue.global.prod.js"></script>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://maps.api.2gis.ru/2.0/loader.js?pkg=full"></script>
    <link href="https://fonts.googleapis.com/css2?family=Ruslan+Display&display=swap" rel="stylesheet">
    
    <style>
        :root { --gold: #D4AF37; --bg: #ffffff; --dark: #1a1a1a; --gray: #8e8e93; --red: #e74c3c; --light-gold: rgba(212, 175, 55, 0.1); }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; outline: none; }
        body { margin: 0; background: var(--bg); font-family: -apple-system, sans-serif; color: var(--dark); overflow-x: hidden; }
        
        /* –•–ï–î–ï–† */
        .header { background: #fff; padding: 15px; text-align: center; border-bottom: 1px solid var(--gold); position: sticky; top: 0; z-index: 100; }
        .old-russian { font-family: 'Ruslan Display', cursive; color: var(--gold); font-size: 24px; margin: 0; text-transform: uppercase; letter-spacing: 2px; }
        
        .container { padding: 15px; padding-bottom: 110px; }

        /* –ö–ê–¢–ï–ì–û–†–ò–ò */
        .cat-row { display: flex; gap: 8px; margin-bottom: 20px; overflow-x: auto; padding-bottom: 5px; scrollbar-width: none; }
        .cat-tab { padding: 10px 20px; border-radius: 25px; border: 1.5px solid var(--gold); background: #fff; color: var(--gold); font-size: 12px; font-weight: bold; white-space: nowrap; }
        .cat-tab.active { background: var(--gold); color: #fff; }

        /* –°–ï–¢–ö–ê –¢–û–í–ê–†–û–í */
        .products-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
        .card { background: #fff; border-radius: 20px; overflow: hidden; border: 1px solid #eee; position: relative; display: flex; flex-direction: column; box-shadow: 0 4px 12px rgba(0,0,0,0.03); }
        
        /* –°–õ–ê–ô–î–ï–† */
        .slider-wrapper { position: relative; width: 100%; aspect-ratio: 3/4; overflow: hidden; }
        .slider-inner { display: flex; overflow-x: auto; scroll-snap-type: x mandatory; scrollbar-width: none; height: 100%; }
        .slider-inner img { width: 100%; height: 100%; object-fit: cover; scroll-snap-align: start; flex-shrink: 0; }

        /* –ü–†–û–ó–†–ê–ß–ù–û–ï –°–ï–†–î–¶–ï */
        .fav-heart { position: absolute; top: 10px; right: 10px; z-index: 10; background: rgba(255,255,255,0.25); backdrop-filter: blur(4px); border: 1px solid rgba(255,255,255,0.4); border-radius: 50%; width: 34px; height: 34px; display: flex; align-items: center; justify-content: center; transition: 0.3s; }
        .fav-heart svg { width: 18px; height: 18px; fill: none; stroke: white; stroke-width: 2.5px; }
        .fav-heart.active svg { fill: var(--red); stroke: var(--red); }

        .card-info { padding: 12px; text-align: center; }
        .card-title { font-size: 13px; font-weight: 600; margin-bottom: 5px; height: 32px; overflow: hidden; }
        .card-price { color: var(--gold); font-weight: 800; font-size: 16px; margin-bottom: 10px; }
        
        /* –†–ê–ó–ú–ï–†–´ */
        .size-btns { display: flex; justify-content: center; gap: 6px; margin-bottom: 12px; }
        .s-btn { flex: 1; padding: 10px 0; border: 1.5px solid #eee; border-radius: 10px; font-size: 13px; font-weight: bold; background: #fff; }
        .s-btn.active { border-color: var(--gold); background: var(--light-gold); color: var(--gold); }

        .buy-btn { width: 100%; padding: 12px; background: var(--gold); color: #fff; border: none; border-radius: 12px; font-size: 11px; font-weight: 800; text-transform: uppercase; }

        /* –ù–ê–í–ò–ì–ê–¶–ò–Ø */
        .bottom-nav { position: fixed; bottom: 0; left: 0; right: 0; background: #fff; display: flex; justify-content: space-around; padding: 10px 0 25px 0; border-top: 1px solid #eee; z-index: 1000; }
        .nav-item { border: none; background: none; color: #b0b0b0; display: flex; flex-direction: column; align-items: center; font-size: 11px; gap: 5px; width: 25%; }
        .nav-item.active { color: var(--gold); }
        .nav-item svg { width: 24px; height: 24px; fill: currentColor; }

        /* –ú–û–î–ê–õ–ö–ê */
        .modal { position: fixed; inset: 0; background: #fff; z-index: 2000; overflow-y: auto; padding-bottom: 40px; }
        .close-m { position: fixed; top: 15px; left: 15px; width: 40px; height: 40px; border-radius: 50%; background: #fff; border: 1px solid #eee; z-index: 2100; display: flex; align-items: center; justify-content: center; font-size: 20px; }

        /* –ö–ê–†–¢–ê */
        #map { width: 100%; height: 200px; border-radius: 15px; margin-top: 10px; border: 1.5px solid var(--gold); }
        .input-c { width: 100%; padding: 14px; border-radius: 12px; border: 1px solid #eee; font-size: 15px; background: #f9f9f9; }
        .order-btn { width: 100%; padding: 18px; background: var(--gold); color: #fff; border: none; border-radius: 18px; font-weight: 800; font-size: 16px; margin-top: 20px; }
    </style>
</head>
<body>

<div id="app">
    <div class="header"><h1 class="old-russian">SVETLANIA</h1></div>

    <div class="container">
        <div v-if="activeTab === 'catalog'">
            <div class="cat-row">
                <button v-for="c in categories" @click="currentCat = c; vibrate()" :class="['cat-tab', currentCat === c ? 'active' : '']">{{c.toUpperCase()}}</button>
            </div>
            <div class="products-grid">
                <div v-for="p in filteredProducts" :key="p.id" class="card">
                    <button class="fav-heart" @click.stop="toggleFav(p)" :class="{active: isFav(p)}">
                        <svg viewBox="0 0 24 24"><path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/></svg>
                    </button>
                    <div class="slider-wrapper" @click="openP(p)">
    <div class="slider-inner" @scroll="e => handleScroll(e, p)">
        <img v-for="img in p.images" :src="img">
    </div>
    <div class="dots" style="position: absolute; bottom: 10px; width: 100%; text-align: center;">
        <span v-for="(img, idx) in p.images" 
              :style="{ display: 'inline-block', width: '6px', height: '6px', borderRadius: '50%', background: idx === p.aIdx ? 'white' : 'rgba(255,255,255,0.5)', margin: '0 3px' }">
        </span>
    </div>
</div>
                    <div class="card-info">
                        <div class="card-title">{{p.name}}</div>
                        <div class="card-price">{{p.price}} ‚ÇΩ</div>
                        <div class="size-btns">
                            <button v-for="s in p.sizes" @click="p.selS = s; vibrate()" :class="['s-btn', p.selS === s ? 'active' : '']">{{s}}</button>
                        </div>
                        <button class="buy-btn" @click="addToCart(p)">–í –∫–æ—Ä–∑–∏–Ω—É</button>
                    </div>
                </div>
            </div>
        </div>

        <div v-if="activeTab === 'favs'">
            <h2 class="old-russian" style="font-size: 18px; margin-bottom: 20px;">–ò–∑–±—Ä–∞–Ω–Ω–æ–µ</h2>
            <div v-if="favItems.length === 0" style="text-align: center; padding: 50px 0; color: var(--gray);">–°–ø–∏—Å–æ–∫ –ø—É—Å—Ç</div>
            <div class="products-grid">
                <div v-for="p in favItems" :key="p.id" class="card">
                    <button class="fav-heart active" @click.stop="toggleFav(p)">
                        <svg viewBox="0 0 24 24"><path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/></svg>
                    </button>
                    <img :src="p.images[0]" style="width:100%; aspect-ratio:3/4; object-fit:cover;" @click="openP(p)">
                    <div class="card-info">
                        <div class="card-price">{{p.price}} ‚ÇΩ</div>
                        <button class="buy-btn" @click="addToCart(p)">–í –∫–æ—Ä–∑–∏–Ω—É</button>
                    </div>
                </div>
            </div>
        </div>

        <div v-if="activeTab === 'cart'">
            <h2 class="old-russian" style="font-size: 18px; margin-bottom: 20px;">–û—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ</h2>
            <div v-if="cart.length === 0" style="text-align: center; padding: 50px 0; color: var(--gray);">–í –∫–æ—Ä–∑–∏–Ω–µ –Ω–∏—á–µ–≥–æ –Ω–µ—Ç</div>
            <div v-else>
                <div v-for="item in cart" :key="item.cartId" style="display: flex; gap: 15px; padding: 15px 0; border-bottom: 1px solid #eee;">
                    <img :src="item.img" style="width: 60px; height: 80px; object-fit: cover; border-radius: 12px;">
                    <div style="flex: 1;">
                        <div style="font-size: 14px; font-weight: 600;">{{item.name}}</div>
                        <div style="font-size: 12px; color: var(--gray);">–†–∞–∑–º–µ—Ä: {{item.size}}</div>
                        <div style="color: var(--gold); font-weight: 700;">{{item.price}} ‚ÇΩ</div>
                    </div>
                    <button @click="removeC(item.cartId)" style="border:none; background:none; font-size:20px;">‚úï</button>
                </div>

                <div style="margin-top: 25px;">
                    <input class="input-c" v-model="form.name" placeholder="–ò–º—è –∏ –§–∞–º–∏–ª–∏—è" style="margin-bottom:10px;">
                    <input class="input-c" v-model="form.phone" placeholder="–¢–µ–ª–µ—Ñ–æ–Ω" type="tel" style="margin-bottom:15px;">
                    <div style="display: flex; gap: 8px; margin-bottom: 10px;">
                        <button v-for="d in ['5post', '–°–î–≠–ö', '–ü–æ—á—Ç–∞']" @click="deliv = d; vibrate(); initMap()" :class="['cat-tab', deliv === d ? 'active' : '']" style="flex:1;">{{d}}</button>
                    </div>
                    <div v-show="deliv">
                        <div style="font-size: 12px; margin-bottom: 5px;">üìç {{address || '–í—ã–±–µ—Ä–∏—Ç–µ –∞–¥—Ä–µ—Å –Ω–∞ –∫–∞—Ä—Ç–µ'}}</div>
                        <div id="map"></div>
                    </div>
                </div>
                <button class="order-btn" @click="send" :disabled="!isValid">–ó–ê–ö–ê–ó–ê–¢–¨: {{total}} ‚ÇΩ</button>
            </div>
        </div>

        <div v-if="activeTab === 'profile'">
            <div style="text-align: center; padding: 40px 0;">
                <img :src="user.photo || 'https://cdn-icons-png.flaticon.com/512/149/149071.png'" style="width: 90px; height: 90px; border-radius: 50%; border: 2px solid var(--gold);">
                <h2>{{user.first_name}}</h2>
                <button class="cat-tab" @click="tg.openTelegramLink('https://t.me/putunkeeva')">–°–ª—É–∂–±–∞ –∑–∞–±–æ—Ç—ã</button>
            </div>
        </div>
    </div>

    <div v-if="selP" class="modal">
        <button class="close-m" @click="selP = null">‚úï</button>
        <div class="slider-wrapper" style="aspect-ratio: 1/1.3;">
    <div class="slider-inner" @scroll="e => handleScroll(e, selP)">
        <img v-for="img in selP.images" :src="img">
    </div>
    <div class="dots" style="position: absolute; bottom: 10px; width: 100%; text-align: center;">
        <span v-for="(img, idx) in selP.images" 
              :style="{ display: 'inline-block', width: '6px', height: '6px', borderRadius: '50%', background: idx === selP.aIdx ? 'white' : 'rgba(255,255,255,0.5)', margin: '0 3px' }">
        </span>
    </div>
</div>
        <div style="padding: 20px;">
            <h2 class="old-russian">{{selP.name}}</h2>
            <div style="font-size: 24px; color: var(--gold); font-weight: 800; margin: 10px 0;">{{selP.price}} ‚ÇΩ</div>
            <p style="font-size: 14px; color: #666; line-height: 1.5;">{{selP.desc}}</p>
            <div class="size-btns" style="margin: 20px 0;">
                <button v-for="s in selP.sizes" @click="selP.selS = s; vibrate()" :class="['s-btn', selP.selS === s ? 'active' : '']" style="padding: 15px;">{{s}}</button>
            </div>
            <button class="order-btn" @click="addToCart(selP)">–î–æ–±–∞–≤–∏—Ç—å –≤ –∫–æ—Ä–∑–∏–Ω—É</button>
        </div>
    </div>

    <nav class="bottom-nav">
        <button @click="activeTab = 'catalog'; vibrate()" :class="['nav-item', activeTab === 'catalog' ? 'active' : '']">
            <svg viewBox="0 0 24 24"><path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"/></svg><span>–ö–∞—Ç–∞–ª–æ–≥</span>
        </button>
        <button @click="activeTab = 'favs'; vibrate()" :class="['nav-item', activeTab === 'favs' ? 'active' : '']">
            <svg viewBox="0 0 24 24"><path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/></svg><span>–ò–∑–±—Ä–∞–Ω–Ω–æ–µ</span>
        </button>
        <button @click="activeTab = 'cart'; vibrate()" :class="['nav-item', activeTab === 'cart' ? 'active' : '']">
            <svg viewBox="0 0 24 24"><path d="M7 18c-1.1 0-1.99.9-1.99 2S5.9 22 7 22s2-.9 2-2-.9-2-2-2zM1 2v2h2l3.6 7.59-1.35 2.45c-.16.28-.25.61-.25.96 0 1.1.9 2 2 2h12v-2H7.42c-.14 0-.25-.11-.25-.25l.03-.12.9-1.63h7.45c.75 0 1.41-.41 1.75-1.03l3.58-6.49c.08-.14.12-.31.12-.48 0-.55-.45-1-1-1H5.21l-.94-2H1zm16 16c-1.1 0-1.99.9-1.99 2s.89 2 1.99 2 2-.9 2-2-.9-2-2-2z"/></svg><span>–ö–æ—Ä–∑–∏–Ω–∞</span>
        </button>
        <button @click="activeTab = 'profile'; vibrate()" :class="['nav-item', activeTab === 'profile' ? 'active' : '']">
            <svg viewBox="0 0 24 24"><path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/></svg><span>–ü—Ä–æ—Ñ–∏–ª—å</span>
        </button>
    </nav>
</div>

<script>
    const tg = window.Telegram.WebApp;
    const { createApp } = Vue;

    createApp({
        data() {
            return {
                activeTab: 'catalog',
                currentCat: '—Ö–∞–ª–∞—Ç—ã',
                categories: ['—Ö–∞–ª–∞—Ç—ã', '—Å–æ—Ä–æ—á–∫–∏'],
                selP: null,
                deliv: '',
                address: '',
                user: { first_name: '–ì–æ—Å—Ç—å', photo: '' },
                form: { name: '', phone: '' },
                products: [
                    { id: 1, category: '—Ö–∞–ª–∞—Ç—ã', name: '–•–∞–ª–∞—Ç "–ö–∏–º–æ–Ω–æ –±–µ–ª–æ–µ —Å –∫—Ä—É–∂–µ–≤–∞–º–∏"', price: 1500, images: ['111white.jpg','111white2.jpg','111white3.jpg','111white4.jpg','111white5.jpg'], sizes: ['S','M','L'], selS: 'S', aIdx: 0, desc: '–ú–∞—Ç–µ—Ä–∏–∞–ª —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç —Ñ–æ—Ä–º—É –∏ —Ü–≤–µ—Ç –¥–∞–∂–µ –ø–æ—Å–ª–µ –º–Ω–æ–≥–æ–∫—Ä–∞—Ç–Ω—ã—Ö —Å—Ç–∏—Ä–æ–∫, –Ω–µ –ª–∏–Ω—è–µ—Ç –∏ –Ω–µ —Ä–∞—Å—Ç—è–≥–∏–≤–∞–µ—Ç—Å—è.–ì–ª–∞–¥–∏—Ç—å –Ω–∞ –Ω–∏–∑–∫–æ–π —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–µ; —Å—Ç–∏—Ä–∫–∞ –ø—Ä–∏ t –Ω–µ –±–æ–ª–µ–µ 30¬∞C.' },
                    { id: 2, category: '—Ö–∞–ª–∞—Ç—ã', name: '–•–∞–ª–∞—Ç "–ö–∏–º–æ–Ω–æ –±–æ—Ä–¥–æ–≤–æ–µ —Å –∫—Ä—É–∂–µ–≤–∞–º–∏"', price: 1500, images: ['111red.jpg','111red2.jpg','111red3.jpg','111red4.jpg'], sizes: ['S','M','L'], selS: 'M', aIdx: 0, desc: '–ú–∞—Ç–µ—Ä–∏–∞–ª —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç —Ñ–æ—Ä–º—É –∏ —Ü–≤–µ—Ç –¥–∞–∂–µ –ø–æ—Å–ª–µ –º–Ω–æ–≥–æ–∫—Ä–∞—Ç–Ω—ã—Ö —Å—Ç–∏—Ä–æ–∫, –Ω–µ –ª–∏–Ω—è–µ—Ç –∏ –Ω–µ —Ä–∞—Å—Ç—è–≥–∏–≤–∞–µ—Ç—Å—è.–ì–ª–∞–¥–∏—Ç—å –Ω–∞ –Ω–∏–∑–∫–æ–π —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–µ; —Å—Ç–∏—Ä–∫–∞ –ø—Ä–∏ t –Ω–µ –±–æ–ª–µ–µ 30¬∞C.' },
                    { id: 3, category: '—Ö–∞–ª–∞—Ç—ã', name: '–•–∞–ª–∞—Ç "–ö–∏–º–æ–Ω–æ —á–µ—Ä–Ω–æ–µ —Å –∫—Ä—É–∂–µ–≤–∞–º–∏"', price: 1500, images: ['111black.jpg','111black2.jpg','111black3.jpg'], sizes: ['S','M','L'], selS: 'S', aIdx: 0, desc: '–ú–∞—Ç–µ—Ä–∏–∞–ª —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç —Ñ–æ—Ä–º—É –∏ —Ü–≤–µ—Ç –¥–∞–∂–µ –ø–æ—Å–ª–µ –º–Ω–æ–≥–æ–∫—Ä–∞—Ç–Ω—ã—Ö —Å—Ç–∏—Ä–æ–∫, –Ω–µ –ª–∏–Ω—è–µ—Ç –∏ –Ω–µ —Ä–∞—Å—Ç—è–≥–∏–≤–∞–µ—Ç—Å—è.–ì–ª–∞–¥–∏—Ç—å –Ω–∞ –Ω–∏–∑–∫–æ–π —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–µ; —Å—Ç–∏—Ä–∫–∞ –ø—Ä–∏ t –Ω–µ –±–æ–ª–µ–µ 30¬∞C.' },
                    { id: 4, category: '—Ö–∞–ª–∞—Ç—ã', name: '–•–∞–ª–∞—Ç "–ö–∏–º–æ–Ω–æ –±–µ–ª–æ–µ —Å –∫—Ä—É–∂–µ–≤–∞–º–∏ —Å –∫–æ—Ä–æ—Ç–∫–∏–º–∏ —Ä—É–∫–∞–≤–∞–º–∏"', price: 1400, images: ['222white.jpg','222white2.jpg','222white3.jpg'], sizes: ['S-M'], selS: 'S', aIdx: 0, desc: '–ú—è–≥–∫–∏–π, –ª–µ–≥–∫–∏–π —Ö–∞–ª–∞—Ç —Å –∫—Ä—É–∂–µ–≤–æ–º –¥–æ—Å—Ç—É–ø–µ–Ω –≤ –µ–¥–∏–Ω–æ–º —Ä–∞–∑–º–µ—Ä–µ (42-44).–ì–ª–∞–¥–∏—Ç—å –Ω–∞ –Ω–∏–∑–∫–æ–π —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–µ; —Å—Ç–∏—Ä–∫–∞ –ø—Ä–∏ t –Ω–µ –±–æ–ª–µ–µ 30¬∞C.' },
                    { id: 5, category: '—Ö–∞–ª–∞—Ç—ã', name: '–•–∞–ª–∞—Ç "–ö–∏–º–æ–Ω–æ —á–µ—Ä–Ω–æ–µ —Å –∫—Ä—É–∂–µ–≤–∞–º–∏ —Å –∫–æ—Ä–æ—Ç–∫–∏–º–∏ —Ä—É–∫–∞–≤–∞–º–∏"', price: 1400, images: ['222black.jpg','222black2.jpg'], sizes: ['S-M'], selS: 'S', aIdx: 0, desc: '–ú—è–≥–∫–∏–π, –ª–µ–≥–∫–∏–π —Ö–∞–ª–∞—Ç —Å –∫—Ä—É–∂–µ–≤–æ–º –¥–æ—Å—Ç—É–ø–µ–Ω –≤ –µ–¥–∏–Ω–æ–º —Ä–∞–∑–º–µ—Ä–µ (42-44).–ì–ª–∞–¥–∏—Ç—å –Ω–∞ –Ω–∏–∑–∫–æ–π —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–µ; —Å—Ç–∏—Ä–∫–∞ –ø—Ä–∏ t –Ω–µ –±–æ–ª–µ–µ 30¬∞C.' },
                    { id: 6, category: '—Å–æ—Ä–æ—á–∫–∏', name: '–°–æ—Ä–æ—á–∫–∞ "–°–æ—Ä–æ—á–∫–∞ —Å —Ö–∞–ª–∞—Ç–æ–º —á–µ—Ä–Ω–∞—è"', price: 1200, images: ['s111black.jpg','s111black2.jpg'], sizes: ['S','M'], selS: 'S', aIdx: 0, desc: '–°–æ—Ä–æ—á–∫–∞ –Ω–∞ –±—Ä–µ—Ç–µ–ª—å–∫–∞—Ö —Ä–µ–≥—É–ª–∏—Ä—É–µ—Ç—Å—è –ø–æ –¥–ª–∏–Ω–µ. –•–∞–ª–∞—Ç - –∫–∏–º–æ–Ω–æ –¥–ª–∏–Ω–æ–π –≤—ã—à–µ –∫–æ–ª–µ–Ω–∞ –∏ —Ä—É–∫–∞–≤–æ–º 3\4.' }
                ],
                cart: JSON.parse(localStorage.getItem('sv_cart') || '[]'),
                favs: JSON.parse(localStorage.getItem('sv_favs') || '[]')
            }
        },
        computed: {
            filteredProducts() { return this.products.filter(p => p.category === this.currentCat) },
            favItems() { return this.products.filter(p => this.favs.includes(p.id)) },
            total() { return this.cart.reduce((s, i) => s + i.price, 0) },
            isValid() { return this.form.name.length > 2 && this.form.phone.length > 10 && this.address && this.cart.length > 0; }
        },
        methods: {
            vibrate() { tg.HapticFeedback.impactOccurred('medium'); },
            handleScroll(e, p) { p.aIdx = Math.round(e.target.scrollLeft / e.target.offsetWidth); },
            toggleFav(p) {
                this.vibrate();
                const i = this.favs.indexOf(p.id);
                i > -1 ? this.favs.splice(i, 1) : this.favs.push(p.id);
                localStorage.setItem('sv_favs', JSON.stringify(this.favs));
            },
            isFav(p) { return this.favs.includes(p.id); },
            openP(p) { this.vibrate(); this.selP = p; },
            addToCart(p) {
                this.vibrate();
                this.cart.push({ cartId: Date.now(), name: p.name, price: p.price, size: p.selS, img: p.images[0] });
                localStorage.setItem('sv_cart', JSON.stringify(this.cart));
                this.selP = null;
            },
            removeC(id) { 
                this.cart = this.cart.filter(i => i.cartId !== id);
                localStorage.setItem('sv_cart', JSON.stringify(this.cart));
            },
            initMap() {
                setTimeout(() => {
                    const map = DG.map('map', { center: [55.75, 37.61], zoom: 11, zoomControl: false });
                    map.on('click', (e) => {
                        this.vibrate();
                        fetch(`https://catalog.api.2gis.com/3.0/items/geocode?lat=${e.latlng.lat}&lon=${e.latlng.lng}&fields=items.address&key=cab82c94-e619-42eb-9814-3361712feaf0`)
                        .then(r => r.json()).then(d => {
                            if (d.result?.items?.length > 0) this.address = d.result.items[0].address_name;
                        });
                    });
                }, 100);
            },
            send() {
    this.vibrate();

    // 1. –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –Ω–æ–º–µ—Ä –∑–∞–∫–∞–∑–∞: –î–∞—Ç–∞ (–î–î–ú–ú–ì–ì) + 5 —Å–ª—É—á–∞–π–Ω—ã—Ö —Ü–∏—Ñ—Ä
    const now = new Date();
    const day = String(now.getDate()).padStart(2, '0');
    const month = String(now.getMonth() + 1).padStart(2, '0');
    const year = String(now.getFullYear()).slice(-2);
    const datePart = `${day}${month}${year}`; // –ü–æ–ª—É—á–∏—Ç—Å—è –Ω–∞–ø—Ä–∏–º–µ—Ä 110126
    
    const randomPart = Math.floor(10000 + Math.random() * 89999); // 5 —Å–ª—É—á–∞–π–Ω—ã—Ö —Ü–∏—Ñ—Ä
    const orderNum = `${datePart}-${randomPart}`; // –ò—Ç–æ–≥: 110126-54321

    // 2. –§–æ—Ä–º–∏—Ä—É–µ–º –æ–±—ä–µ–∫—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –±–æ—Ç–∞
    const orderData = {
        order_id: orderNum, // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Å–æ–∑–¥–∞–Ω–Ω—ã–π –Ω–æ–º–µ—Ä
        user: {
            name: this.form.name,
            phone: this.form.phone
        },
        cart: this.cart,
        total: this.total,
        address: this.address,
        delivery: this.deliv || "–ù–µ –≤—ã–±—Ä–∞–Ω"
    };

    // 3. –û—Ç–ø—Ä–∞–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö –±–æ—Ç—É
    tg.sendData(JSON.stringify(orderData));

    // 4. –û—á–∏—Å—Ç–∫–∞ –∏ –∑–∞–∫—Ä—ã—Ç–∏–µ (Local Store)
    localStorage.removeItem('sv_cart');
    this.cart = [];
    
    setTimeout(() => {
        tg.close();
    }, 150);
}
        },
        mounted() {
            tg.ready(); tg.expand();
            if (tg.initDataUnsafe?.user) {
                const u = tg.initDataUnsafe.user;
                this.user = { first_name: u.first_name, photo: u.photo_url };
                this.form.name = (u.first_name + ' ' + (u.last_name || '')).trim();
            }
        }
    }).mount('#app');
</script>
</body>
</html>
